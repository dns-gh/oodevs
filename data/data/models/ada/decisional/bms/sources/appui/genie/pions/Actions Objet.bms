includedFiles = includedFiles or {}
includedFiles["sources/appui/genie/pions/Actions Objet.bms"] = true

include "bit.lua"


--[[// ****************************************************************************
]]--[[// ACT_Obj_Pion_GEN_RealiserTravaux
]]--[[//
]]--[[// Commentaires:
]]--[[//
]]--[[// ****************************************************************************
]]node "ACT_Obj_Pion_GEN_RealiserTravaux"
{
    actuators =
    {
        obstacle = 1,
        deplacement = 1,
    },

    create = function( self )
        self._namedParams = {}
        self._namedParams.objet = self.params[1]
    end,

    select = function( self )
        --[[//booleens suspension reprise et terminaison
]]        self.eActionObjet = self.eActionObjet or eActionObjetEnCours
        self.bSuspendu = self.bSuspendu or false
        self.bInit = self.bInit or true
        self.act = self.act or nil
        --[[//-----------------------------------------------------------------
]]--[[// Init
]]--[[//-----------------------------------------------------------------
]]if( ModuleBegins() ) then
            do
                if( not DEC_Agent_AutomateEstEmbraye() ) then
                    DEC_RC( eRC_OrganisationChantier )
                else
                    DEC_Message( eRC_OrganisationChantier )
                end

            end
--[[//-----------------------------------------------------------------
]]--[[// Début travaux
]]--[[//-----------------------------------------------------------------
]]        end

        if( self.bInit and DEC_Agent_NiveauInstallation() >= eNiveauInstallation_Poste ) then
            do
                local type = DEC_GenObject_Type( self._namedParams.objet )
                if( type == S_TypeObject_ToString( eTypeObjectCampPrisonniers ) or type == S_TypeObject_ToString( eTypeObjectCampRefugies ) ) then
                    self.act = DEC_StartCreerObjet( myself.objMisEnCours_, type, DEC_GenObject_Localisation( self._namedParams.objet ), DEC_GenObject_TC2( self._namedParams.objet ) )
                    actionCallbacks[ self.act ] = function( arg ) self.eActionObjet = arg end
                    actionKnowledgeCallbacks[ self.act ] = function( arg ) myself.objMisEnCours_ = arg end

                else
if( type == S_TypeObject_ToString( eTypeObjectZoneMineeLineaire ) or type == S_TypeObject_ToString( eTypeObjectZoneMineeParDispersion ) ) then
                        self.act = DEC_StartCreerObjet( myself.objMisEnCours_, type, DEC_GenObject_Localisation( self._namedParams.objet ), DEC_GenObject_Densite( self._namedParams.objet ), DEC_GenObject_DelaiActiviteMines( self._namedParams.objet ) )
                        actionCallbacks[ self.act ] = function( arg ) self.eActionObjet = arg end
                        actionKnowledgeCallbacks[ self.act ] = function( arg ) myself.objMisEnCours_ = arg end

                    else
if( type == S_TypeObject_ToString( eTypeObjectBouchonMines ) ) then
                            self.act = DEC_StartCreerObjet( myself.objMisEnCours_, type, DEC_GenObject_Localisation( self._namedParams.objet ), DEC_GenObject_DelaiActiviteMines( self._namedParams.objet ) )
                            actionCallbacks[ self.act ] = function( arg ) self.eActionObjet = arg end
                            actionKnowledgeCallbacks[ self.act ] = function( arg ) myself.objMisEnCours_ = arg end

                        else
                            --[[// Autres objets
]]self.act = DEC_StartCreerObjet( myself.objMisEnCours_, type, DEC_GenObject_Localisation( self._namedParams.objet ) )
                            actionCallbacks[ self.act ] = function( arg ) self.eActionObjet = arg end
                            actionKnowledgeCallbacks[ self.act ] = function( arg ) myself.objMisEnCours_ = arg end

                        end
                    end
                end

                do
                    if( not DEC_Agent_AutomateEstEmbraye() ) then
                        DEC_RC( eRC_DebutTravaux )
                    else
                        DEC_Message( eRC_DebutTravaux )
                    end

                end

                self.bInit = false
            end
--[[//-----------------------------------------------------------------
]]--[[// RC éventuels
]]--[[//-----------------------------------------------------------------
]]        end

         do
            local switch_1 = self.eActionObjet
            local cases_switch_1 = {}
                if switch_1 == eActionObjetTerminee then
                    DEC_Trace( "  end of works " )
                    do
                        if( not DEC_Agent_AutomateEstEmbraye() ) then
                            DEC_RC( eRC_FinTravaux )
                        else
                            DEC_Message( eRC_FinTravaux )
                        end

                    end

                                        self.params.__returnValue = eActionEffectuee
                    return

                    
                elseif switch_1 == eActionObjetManqueDotation
                or switch_1 == eActionObjetPasDeCapacite
                or switch_1 == eActionObjetImpossible then
                    DEC_Trace( "  impossible works " )
                    DEC_Trace( EnumToString( self.eActionObjet, E_EtatActionObjet ) )
                                        self.params.__returnValue = eActionEffectuee
                    return

                    
                                end
            end
--[[//-----------------------------------------------------------------
]]--[[// Reprise si suspendu
]]--[[//-----------------------------------------------------------------
]]
        if( self.bSuspendu and DEC_Agent_NiveauInstallation() >= eNiveauInstallation_Poste ) then
            do
                DEC_ReprendAction( self.act )
                self.bSuspendu = false
            end
        end

    end,

    deselect = function( self )
                DEC_PauseAction( self.act )
        self.bSuspendu = true
    end,

    destroy = function( self )
                self.act = DEC_StopAction( self.act )
    end,

}

--[[// ******************************************************************************
]]--[[// ACT_Obj_Pion_GEN_PreparerObstacle
]]--[[//
]]--[[// Commentaires: pour obstacle de manoeuvre
]]--[[//
]]--[[// ******************************************************************************
]]node "ACT_Obj_Pion_GEN_PreparerObstacle"
{
    actuators =
    {
        obstacle = 1,
        deplacement = 1,
    },

    create = function( self )
        self._namedParams = {}
        self._namedParams.obstacle = self.params[1]
    end,

    select = function( self )
        --[[//booleens suspension reprise et terminaison
]]        self.eActionObjet = self.eActionObjet or eActionObjetEnCours
        self.bSuspendu = self.bSuspendu or false
        self.bInit = self.bInit or true
        self.act = self.act or nil
        --[[//-----------------------------------------------------------------
]]--[[// Init
]]--[[//-----------------------------------------------------------------
]]if( ModuleBegins() ) then
            do
                if( not DEC_Agent_AutomateEstEmbraye() ) then
                    DEC_RC( eRC_OrganisationChantier )
                else
                    DEC_Message( eRC_OrganisationChantier )
                end

            end
--[[//-----------------------------------------------------------------
]]--[[// Début creation objet
]]--[[//-----------------------------------------------------------------
]]        end

        if( self.bInit and DEC_Agent_NiveauInstallation() >= eNiveauInstallation_Poste ) then
            do
                self.act = DEC_StartPreparerObjet( myself.objMisEnCours_, DEC_GenObject_Type( self._namedParams.obstacle ), DEC_GenObject_Localisation( self._namedParams.obstacle ), DEC_GenObject_Densite( self._namedParams.obstacle ) )
                actionCallbacks[ self.act ] = function( arg ) self.eActionObjet = arg end
                actionKnowledgeCallbacks[ self.act ] = function( arg ) myself.objMisEnCours_ = arg end

                                do
                    if( not DEC_Agent_AutomateEstEmbraye() ) then
                        DEC_RC( eRC_DebutTravaux )
                    else
                        DEC_Message( eRC_DebutTravaux )
                    end

                end

                DEC_Trace( "Create prepared object: begin" )
                self.bInit = false
            end
--[[//-----------------------------------------------------------------
]]--[[// RC éventuels
]]--[[//-----------------------------------------------------------------
]]        end

         do
            local switch_1 = self.eActionObjet
            local cases_switch_1 = {}
                if switch_1 == eActionObjetTerminee then
                    do
                        if( not DEC_Agent_AutomateEstEmbraye() ) then
                            DEC_RC( eRC_FinTravaux )
                        else
                            DEC_Message( eRC_FinTravaux )
                        end

                    end

                                        self.params.__returnValue = eActionEffectuee
                    return

                                end
                if cases_switch_1[1] or switch_1 == eActionObjetPasDeCapacite
                or switch_1 == eActionObjetImpossible
                or switch_1 == eActionObjetManqueDotation then
                    DEC_Trace( "Impossible to build the object" )
                                        self.params.__returnValue = eActionEffectuee
                    return

                    
                                end
            end
--[[//-----------------------------------------------------------------
]]--[[// Reprise si suspendu
]]--[[//-----------------------------------------------------------------
]]
        if( self.bSuspendu and DEC_Agent_NiveauInstallation() >= eNiveauInstallation_Poste ) then
            do
                DEC_ReprendAction( self.act )
                self.bSuspendu = false
            end
        end

    end,

    deselect = function( self )
                DEC_PauseAction( self.act )
        self.bSuspendu = true
    end,

    destroy = function( self )
                self.act = DEC_StopAction( self.act )
    end,

}

--[[// ******************************************************************************
]]--[[// ACT_Obj_Pion_GEN_ActiverObstacle
]]--[[//
]]--[[// Commentaires:
]]--[[//
]]--[[// Revision MIA
]]--[[//
]]--[[// ******************************************************************************
]]node "ACT_Obj_Pion_GEN_ActiverObstacle"
{
    create = function( self )
        self._namedParams = {}
        self._namedParams.repObj = self.params[1]
    end,

    select = function( self )
        --[[//-----------------------------------------------------------------
]]--[[// Init
]]--[[//-----------------------------------------------------------------
]]if( ModuleBegins() ) then
            DEC_Trace( "  activate obstacle" )
        end

        --[[//-----------------------------------------------------------------
]]--[[// Activation // MIA c'est ici qu'il faut renvoyer l'info! Il faut
]]--[[// une fonction : DEC_PeutActiverObstacle()
]]--[[//-----------------------------------------------------------------
]]if( DEC_ActiverObjet( self._namedParams.repObj ) ) then
            do
                DEC_Trace( "  end of activation " )
                                self.params.__returnValue = eActionEffectuee
                return

            end
        else
            self.params.__returnValue = eActionImpossible
            return
        end

    end,

}

--[[// ******************************************************************************
]]--[[// ACT_Obj_Pion_GEN_ValoriserObstacle()
]]--[[//
]]--[[// Commentaires:
]]--[[//
]]--[[// Révision MIA
]]--[[//
]]--[[// ******************************************************************************
]]node "ACT_Obj_Pion_GEN_ValoriserObstacle"
{
    actuators =
    {
        obstacle = 1,
    },

    create = function( self )
        self._namedParams = {}
        self._namedParams.repObj = self.params[1]
    end,

    select = function( self )
        --[[//booleens suspension reprise et terminaison
]]        self.eActionObjet = self.eActionObjet or eActionObjetEnCours
        self.bSuspendu = self.bSuspendu or false
        self.bInit = self.bInit or true
        self.act = self.act or nil
        --[[//-----------------------------------------------------------------
]]--[[// Init
]]--[[//-----------------------------------------------------------------
]]if( ModuleBegins() ) then
            do
                if( not DEC_Agent_AutomateEstEmbraye() ) then
                    DEC_RC( eRC_OrganisationChantier )
                else
                    DEC_Message( eRC_OrganisationChantier )
                end

            end
--[[//-----------------------------------------------------------------
]]--[[// Début creation objet
]]--[[//-----------------------------------------------------------------
]]        end

        if( self.bInit and DEC_Agent_NiveauInstallation() >= eNiveauInstallation_Poste ) then
            do
                self.act = DEC_StartValoriserObjet( self._namedParams.repObj )
                actionCallbacks[ self.act ] = function( arg ) self.eActionObjet = arg end

                                do
                    if( not DEC_Agent_AutomateEstEmbraye() ) then
                        DEC_RC( eRC_DebutTravaux )
                    else
                        DEC_Message( eRC_DebutTravaux )
                    end

                end

                DEC_Trace( "----- To improve obstacle: begin ----" )
                self.bInit = false
            end
--[[//-----------------------------------------------------------------
]]--[[// RC éventuels
]]--[[//-----------------------------------------------------------------
]]        end

         do
            local switch_1 = self.eActionObjet
            local cases_switch_1 = {}
                if switch_1 == eActionObjetTerminee then
                    do
                        if( not DEC_Agent_AutomateEstEmbraye() ) then
                            DEC_RC( eRC_FinTravaux )
                        else
                            DEC_Message( eRC_FinTravaux )
                        end

                    end

                                        self.params.__returnValue = eActionEffectuee
                    return

                                end
                if cases_switch_1[1] or switch_1 == eActionObjetPasDeCapacite
                or switch_1 == eActionObjetImpossible
                or switch_1 == eActionObjetManqueDotation then
                    DEC_Trace( "Impossible to improve the object" )
                                        self.params.__returnValue = eActionEffectuee
                    return

                    
                                end
            end
--[[//-----------------------------------------------------------------
]]--[[// Reprise si suspendu
]]--[[//-----------------------------------------------------------------
]]
        if( self.bSuspendu and DEC_Agent_NiveauInstallation() >= eNiveauInstallation_Poste ) then
            do
                DEC_ReprendAction( self.act )
                self.bSuspendu = false
            end
        end

    end,

    deselect = function( self )
                DEC_PauseAction( self.act )
        self.bSuspendu = true
    end,

    destroy = function( self )
                self.act = DEC_StopAction( self.act )
    end,

}

--[[// ******************************************************************************
]]--[[// ACT_Obj_Pion_GEN_ReduireObstacle
]]--[[//
]]--[[// Commentaires:
]]--[[//
]]--[[// ******************************************************************************
]]node "ACT_Obj_Pion_GEN_ReduireObstacle"
{
    actuators =
    {
        obstacle = 1,
        deplacement = 1,
    },

    create = function( self )
        self._namedParams = {}
        self._namedParams.repObj = self.params[1]
    end,

    select = function( self )
        --[[//booleens suspension reprise et terminaison
]]        self.eActionObjet = self.eActionObjet or eActionObjetEnCours
        self.bSuspendu = self.bSuspendu or false
        self.bInit = self.bInit or true
        self.act = self.act or nil
        --[[//-----------------------------------------------------------------
]]--[[// Init
]]--[[//-----------------------------------------------------------------
]]if( ModuleBegins() ) then
            do
                if( not DEC_Agent_AutomateEstEmbraye() ) then
                    DEC_RC( eRC_OrganisationChantier )
                else
                    DEC_Message( eRC_OrganisationChantier )
                end

            end
--[[//-----------------------------------------------------------------
]]--[[// Début creation objet
]]--[[//-----------------------------------------------------------------
]]        end

        if( self.bInit and DEC_Agent_NiveauInstallation() >= eNiveauInstallation_Poste ) then
            do
                self.act = DEC_StartDetruireObjet( self._namedParams.repObj )
                actionCallbacks[ self.act ] = function( arg ) self.eActionObjet = arg end

                                do
                    if( not DEC_Agent_AutomateEstEmbraye() ) then
                        DEC_RC( eRC_DebutTravaux )
                    else
                        DEC_Message( eRC_DebutTravaux )
                    end

                end

                DEC_Trace( "Begin to remove" )
                self.bInit = false
            end
--[[//-----------------------------------------------------------------
]]--[[// RC éventuels
]]--[[//-----------------------------------------------------------------
]]        end

         do
            local switch_1 = self.eActionObjet
            local cases_switch_1 = {}
                if switch_1 == eActionObjetTerminee then
                    do
                        if( not DEC_Agent_AutomateEstEmbraye() ) then
                            DEC_RC( eRC_FinTravaux )
                        else
                            DEC_Message( eRC_FinTravaux )
                        end

                    end

                                        self.params.__returnValue = eActionEffectuee
                    return

                                end
                if cases_switch_1[1] or switch_1 == eActionObjetPasDeCapacite
                or switch_1 == eActionObjetImpossible
                or switch_1 == eActionObjetManqueDotation then
                    DEC_Trace( "Impossible to remove the object" )
                    
                                cases_switch_1[2] = true
                end
            end
--[[//-----------------------------------------------------------------
]]--[[// Reprise si suspendu
]]--[[//-----------------------------------------------------------------
]]
        if( self.bSuspendu and DEC_Agent_NiveauInstallation() >= eNiveauInstallation_Poste ) then
            do
                DEC_ReprendAction( self.act )
                self.bSuspendu = false
            end
        end

    end,

    deselect = function( self )
                DEC_PauseAction( self.act )
        self.bSuspendu = true
    end,

    destroy = function( self )
                self.act = DEC_StopAction( self.act )
    end,

}

--[[// ******************************************************************************
]]--[[// ACT_Obj_Pion_GEN_CreerContournement
]]--[[//
]]--[[// Commentaires: coefficient de gain de contournement
]]--[[//
]]--[[// ******************************************************************************
]]node "ACT_Obj_Pion_GEN_CreerContournement"
{
    actuators =
    {
        obstacle = 1,
        deplacement = 1,
    },

    create = function( self )
        self._namedParams = {}
        self._namedParams.repObj = self.params[1]
    end,

    select = function( self )
        --[[//booleens suspension reprise et terminaison
]]        self.eActionObjet = self.eActionObjet or eActionObjetEnCours
        self.bSuspendu = self.bSuspendu or false
        self.bInit = self.bInit or true
        self.act = self.act or nil
        --[[//-----------------------------------------------------------------
]]--[[// Init
]]--[[//-----------------------------------------------------------------
]]if( ModuleBegins() ) then
            do
                if( not DEC_Agent_AutomateEstEmbraye() ) then
                    DEC_RC( eRC_OrganisationChantier )
                else
                    DEC_Message( eRC_OrganisationChantier )
                end

            end
--[[//-----------------------------------------------------------------
]]--[[// Début contournement
]]--[[//-----------------------------------------------------------------
]]        end

        if( self.bInit and DEC_Agent_NiveauInstallation() >= eNiveauInstallation_Poste ) then
            do
                self.act = DEC_StartCreerContournementObjet( self._namedParams.repObj )
                actionCallbacks[ self.act ] = function( arg ) self.eActionObjet = arg end

                                do
                    if( not DEC_Agent_AutomateEstEmbraye() ) then
                        DEC_RC( eRC_DebutTravaux )
                    else
                        DEC_Message( eRC_DebutTravaux )
                    end

                end

                self.bInit = false
            end
--[[//-----------------------------------------------------------------
]]--[[// RC éventuels
]]--[[//-----------------------------------------------------------------
]]        end

         do
            local switch_1 = self.eActionObjet
            local cases_switch_1 = {}
                if switch_1 == eActionObjetTerminee then
                    do
                        if( not DEC_Agent_AutomateEstEmbraye() ) then
                            DEC_RC( eRC_ContournementRealise )
                        else
                            DEC_Message( eRC_ContournementRealise )
                        end

                    end

                                        self.params.__returnValue = eActionEffectuee
                    return

                                end
                if cases_switch_1[1] or switch_1 == eActionObjetManqueDotation
                or switch_1 == eActionObjetPasDeCapacite
                or switch_1 == eActionObjetImpossible then
                    DEC_Trace( "Impossible to bypass" )
                    
                                cases_switch_1[2] = true
                end
            end
--[[//-----------------------------------------------------------------
]]--[[// Reprise si suspendu
]]--[[//-----------------------------------------------------------------
]]
        if( self.bSuspendu and DEC_Agent_NiveauInstallation() >= eNiveauInstallation_Poste ) then
            do
                DEC_ReprendAction( self.act )
                self.bSuspendu = false
            end
        end

    end,

    deselect = function( self )
                DEC_PauseAction( self.act )
        self.bSuspendu = true
    end,

    destroy = function( self )
                self.act = DEC_StopAction( self.act )
    end,

}

--[[// ******************************************************************************
]]--[[// ACT_Obj_Pion_GEN_ReprendreTravaux
]]--[[//
]]--[[// Commentaires:
]]--[[//
]]--[[// ******************************************************************************
]]node "ACT_Obj_Pion_GEN_ReprendreTravaux"
{
    actuators =
    {
        obstacle = 1,
        deplacement = 1,
    },

    create = function( self )
        self._namedParams = {}
        self._namedParams.repObj = self.params[1]
    end,

    select = function( self )
        --[[//booleens suspension reprise et terminaison
]]        self.eActionObjet = self.eActionObjet or eActionObjetEnCours
        self.bSuspendu = self.bSuspendu or false
        self.bInit = self.bInit or true
        self.act = self.act or nil
        --[[//-----------------------------------------------------------------
]]--[[// Init
]]--[[//-----------------------------------------------------------------
]]if( ModuleBegins() ) then
            do
                if( not DEC_Agent_AutomateEstEmbraye() ) then
                    DEC_RC( eRC_OrganisationChantier )
                else
                    DEC_Message( eRC_OrganisationChantier )
                end

            end
--[[//-----------------------------------------------------------------
]]--[[// Début contournement
]]--[[//-----------------------------------------------------------------
]]        end

        if( self.bInit and DEC_Agent_NiveauInstallation() >= eNiveauInstallation_Poste ) then
            do
                DEC_Trace( "  resume obstacle creation: " )
                self.act = DEC_StartReprendreTravauxObjet( self._namedParams.repObj )
                actionCallbacks[ self.act ] = function( arg ) self.eActionObjet = arg end

                                do
                    if( not DEC_Agent_AutomateEstEmbraye() ) then
                        DEC_RC( eRC_DebutTravaux )
                    else
                        DEC_Message( eRC_DebutTravaux )
                    end

                end

                self.bInit = false
            end
--[[//-----------------------------------------------------------------
]]--[[// RC éventuels
]]--[[//-----------------------------------------------------------------
]]        end

         do
            local switch_1 = self.eActionObjet
            local cases_switch_1 = {}
                if switch_1 == eActionObjetTerminee then
                    do
                        if( not DEC_Agent_AutomateEstEmbraye() ) then
                            DEC_RC( eRC_FinTravaux )
                        else
                            DEC_Message( eRC_FinTravaux )
                        end

                    end

                                        self.params.__returnValue = eActionEffectuee
                    return

                                end
                if cases_switch_1[1] or switch_1 == eActionObjetManqueDotation
                or switch_1 == eActionObjetPasDeCapacite
                or switch_1 == eActionObjetImpossible then
                    DEC_Trace( "impossible obstacle creation" )
                    
                                cases_switch_1[2] = true
                end
            end
--[[//-----------------------------------------------------------------
]]--[[// Reprise si suspendu
]]--[[//-----------------------------------------------------------------
]]
        if( self.bSuspendu and DEC_Agent_NiveauInstallation() >= eNiveauInstallation_Poste ) then
            do
                DEC_ReprendAction( self.act )
                self.bSuspendu = false
            end
        end

    end,

    deselect = function( self )
                DEC_PauseAction( self.act )
        self.bSuspendu = true
    end,

    destroy = function( self )
                self.act = DEC_StopAction( self.act )
    end,

}

