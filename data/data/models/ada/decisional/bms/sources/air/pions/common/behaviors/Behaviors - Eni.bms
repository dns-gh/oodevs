includedFiles = includedFiles or {}
includedFiles["sources/air/pions/common/behaviors/Behaviors - Eni.bms"] = true

include "bit.lua"


--[[// *****************************************************************************
]]--[[// FrappeIndirecte
]]--[[//
]]--[[// Commentaires :
]]--[[//
]]--[[// *****************************************************************************
]]node "BEH_Eni_Pion_AIR_FrappeIndirecteSur"
{
    feedbacks = { { { "done_BEH_Eni_Pion_AIR_FrappeIndirecteSur" }, "BEH_Eni_Pion_AIR_FrappeIndirecteSur" } },
    SendFeedback = function( self, value ) Feedback( self.feedbacks.done_BEH_Eni_Pion_AIR_FrappeIndirecteSur, {value} ) end,
    instances =
    {
        max = 1,
    },

    activations =
    {
        { "ACT_Tir_IndirectSurPosition", { "done_ACT_Tir_IndirectSurPosition" } },
    },

    create = function( self )
        self._namedParams = {}
        self._namedParams.ennemi = self.params[1]
        self._namedParams.niveauPerception = self.params[2]
        self._namedParams.nombreIT = self.params[3]
        self._namedParams.typeObus = self.params[4]
        self._namedParams.pH = self.params[5]
    end,

    activate = function( self )
        --[[// variables persistantes
]]        self.eEtatAttaque = self.eEtatAttaque or eActionEnCours
        if( not DEC_ConnaissanceAgent_EstValide( self._namedParams.ennemi ) ) then
            self:SendFeedback( eActionImpossible )
            Halt( self )
            do return end
        end

        local peutToucher = S_Tir_DistancePorteeIndirect_EstValide( DEC_Tir_MunitionPourTirIndirect( self._namedParams.typeObus, DEC_ConnaissanceAgent_Position( self._namedParams.ennemi ) ), DEC_ConnaissanceAgent_Position( self._namedParams.ennemi ) )
        --[[// si la connaissance est du niveau demandé et qu'elle est a portée de tir
]]if( peutToucher and S_Eni_EstNiveauPerceptionGTIA( self._namedParams.ennemi, self._namedParams.niveauPerception ) ) then
            Activate( self.activations.ACT_Tir_IndirectSurPosition, 1, { DEC_ConnaissanceAgent_Position( self._namedParams.ennemi ), self._namedParams.nombreIT, DEC_Tir_MunitionPourTirIndirect( self._namedParams.typeObus, DEC_ConnaissanceAgent_Position( self._namedParams.ennemi ) ), } )
        end

    end,

    destroy = function( self )
                if( not S_Misc_EstDetruitPhysique() ) then
if( DEC_ConnaissanceAgent_EstValide( self._namedParams.ennemi ) ) then
if( DEC_ConnaissanceAgent_EstMort( self._namedParams.ennemi ) ) then
                    DEC_RC( eRC_EnnemiDetruit, self._namedParams.ennemi )
                end
            end
        end

    end,

}

connections = connections or {}
connections[ #connections + 1 ] = { nodes.BEH_Eni_Pion_AIR_FrappeIndirecteSur, "ACT_Tir_IndirectSurPosition", nodes.ACT_Tir_IndirectSurPosition }
