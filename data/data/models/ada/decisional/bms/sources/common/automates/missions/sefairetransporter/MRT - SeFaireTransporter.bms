includedFiles = includedFiles or {}
includedFiles["sources/common/automates/missions/sefairetransporter/MRT - SeFaireTransporter.bms"] = true

local emptyTable = emptyTable

--[[// *****************************************************************************
]]--[[// $Created$
]]--[[// $Archive: /MVW_v10/Build/Data/Data/Modeles/Sources/Common/Automates/Missions/SeFaireTransporter/MRT - SeFaireTransporter.hal $
]]--[[// $Author: Ggr $
]]--[[// $Modtime: 26/08/05 17:57 $
]]--[[// $Revision: 7 $
]]--[[// $Workfile: MRT - SeFaireTransporter.hal $
]]--[[// *****************************************************************************
]]

--[[// *****************************************************************************
]]--[[// MIS_Automate_MRT_SeFaireTransporter
]]--[[//
]]--[[// Commentaires:
]]--[[//
]]--[[// *****************************************************************************
]]node "MIS_Automate_MRT_SeFaireTransporter"
{
    feedbacks = { { { "done_MIS_Automate_MRT_SeFaireTransporter" }, "MIS_Automate_MRT_SeFaireTransporter" } },
    SendFeedback = function( self, value ) Feedback( self.feedbacks.done_MIS_Automate_MRT_SeFaireTransporter, {value} ) end,
    activations =
    {
        { "BEH_Medo_Automate_PreparerMission_SeFaireTransporter", { "done_BEH_Medo_Automate_PreparerMission_SeFaireTransporter" } },
    },

    create = function( self )
        self._namedParams = {}
        self._namedParams.mission = self.params.mission
    end,

    activate = function( self )
        local Activate = Activate
        self.eCreationMRT = self.eCreationMRT or eActionEnCours
        --[[//-----------------------------------------------------------------------------
]]--[[// Init
]]--[[//-----------------------------------------------------------------------------
]]if( ModuleBegins() ) then
            DEC_SetMission( myself, self._namedParams.mission )
        end

        --[[//-----------------------------------------------------------------------------
]]--[[// MRT creee
]]--[[//-----------------------------------------------------------------------------
]]if( self.eCreationMRT == eActionImpossible ) then
            do
                                do
                    DEC_RC( eRC_MissionImpossible )
                end

                                self:SendFeedback( eActionImpossible )
                Halt( self )
                do return end

            end
        end

        if( self.eCreationMRT == eActionEffectuee ) then
            do
                self.eCreationMRT = eActionEnCours
                                do
                    DEC_MRT_Valide()
                                        self:SendFeedback( eActionEffectuee )
                    Halt( self )
                    do return end

                end

            end
        end

        Activate( self.activations.BEH_Medo_Automate_PreparerMission_SeFaireTransporter, 1, { self._namedParams.mission.zoneEmbarquement_, } )
self.done_BEH_Medo_Automate_PreparerMission_SeFaireTransporter = function( self, _, v ) self.eCreationMRT = v[1] end
    end,

--[[// *****************************************************************************
]]--[[// BEH_Medo_Automate_PreparerMission_SeFaireTransporter
]]--[[//
]]--[[// Commentaires:
]]--[[//
]]--[[// *****************************************************************************
]]}

node "BEH_Medo_Automate_PreparerMission_SeFaireTransporter"
{
    feedbacks = { { { "done_BEH_Medo_Automate_PreparerMission_SeFaireTransporter" }, "BEH_Medo_Automate_PreparerMission_SeFaireTransporter" } },
    SendFeedback = function( self, value ) Feedback( self.feedbacks.done_BEH_Medo_Automate_PreparerMission_SeFaireTransporter, {value} ) end,
    activations =
    {
        { "BEH_Medo_Automate_ControleCreationMission", { "done_BEH_Medo_Automate_ControleCreationMission" } },
        { "BEH_Medo_Automate_FaireTransporter_DansZone", { "done_BEH_Medo_Automate_FaireTransporter_DansZone" } },
    },

    create = function( self )
        self._namedParams = {}
        self._namedParams.Zone = self.params[1]
    end,

    activate = function( self )
        local Activate = Activate
        self.selPions = self.selPions or DEC_Automate_PionsAvecPC()
        self.ePhase = self.ePhase or eMRT_SelectionnerPions
        self.eActionMRT = self.eActionMRT or eActionEnCours
        self.eValidationMRT = self.eValidationMRT or eActionEnCours
         do
            local _continue = true
--[[//-----------------------------------------------------------------------------
]]--[[// Vérif et assignation des missions
]]--[[//-----------------------------------------------------------------------------
]]--[[//-----------------------------------------------------------------------------
]]--[[//	Distribution des types de mission
]]--[[//-----------------------------------------------------------------------------
]]--[[//-----------------------------------------------------------------------------
]]--[[// Assigner les missions au pions subordonnéss
]]--[[//-----------------------------------------------------------------------------
]]--[[// Assigne les missions
]]            local switch_1 = self.ePhase
                if switch_1 == eMRT_SelectionnerPions then
                    if( #( self.selPions ) == 0 ) then
                        do
                                                        self:SendFeedback( eActionImpossible )
                            Halt( self )
                            do return end

                        end
                    end

                    self.ePhase = eMRT_AssignerMissions
                    _continue = false
                elseif switch_1 == eMRT_AssignerMissions then
                    if( self.eActionMRT == eActionImpossible ) then
                        do
                                                        do
                            end

                                                        self:SendFeedback( eActionImpossible )
                            Halt( self )
                            do return end

                        end
                    end

                    if( self.eValidationMRT == eActionEffectuee ) then
                        do
                            self.eValidationMRT = eActionEnCours
                                                        do
                                                                self:SendFeedback( eActionEffectuee )
                                Halt( self )
                                do return end

                            end

                        end
                    end

                    Activate( self.activations.BEH_Medo_Automate_ControleCreationMission, 1, { #( self.selPions ), } )
self.done_BEH_Medo_Automate_ControleCreationMission = function( self, _, v ) self.eValidationMRT = v[1] end
                    Activate( self.activations.BEH_Medo_Automate_FaireTransporter_DansZone, 1, { self.selPions, self._namedParams.Zone, } )
self.done_BEH_Medo_Automate_FaireTransporter_DansZone = function( self, _, v ) self.eActionMRT = v[1] end
                    _continue = false
                                end
            end

    end,

--[[// *****************************************************************************
]]--[[// BEH_Medo_Automate_FaireTransporter_DansZone
]]--[[//
]]--[[// Commentaires:
]]--[[//
]]--[[// *****************************************************************************
]]}

node "BEH_Medo_Automate_FaireTransporter_DansZone"
{
    feedbacks = { { { "done_BEH_Medo_Automate_FaireTransporter_DansZone" }, "BEH_Medo_Automate_FaireTransporter_DansZone" } },
    SendFeedback = function( self, value ) Feedback( self.feedbacks.done_BEH_Medo_Automate_FaireTransporter_DansZone, {value} ) end,
    activations =
    {
        { "BEH_Mission_Automate_AssignerSeFaireTransporterA_DansZone", { "done_BEH_Mission_Automate_AssignerSeFaireTransporterA_DansZone" } },
    },

    create = function( self )
        self._namedParams = {}
        self._namedParams.selPions = self.params[1]
        self._namedParams.locZone = self.params[2]
    end,

    activate = function( self )
        local Activate = Activate
        self.ptCentreZone = self.ptCentreZone or S_Geometrie_BarycentreZone( self._namedParams.locZone )
        for _,x_pion in pairs( self._namedParams.selPions or emptyTable ) do
        local _continue = true
            Activate( self.activations.BEH_Mission_Automate_AssignerSeFaireTransporterA_DansZone, 1, { x_pion, self.ptCentreZone, } )

        end

    end,

--[[// *****************************************************************************
]]--[[// BEH_Mission_Automate_AssignerSeFaireTransporterA_DansZone
]]--[[//
]]--[[// Commentaires:
]]--[[//
]]--[[// *****************************************************************************
]]}

node "BEH_Mission_Automate_AssignerSeFaireTransporterA_DansZone"
{
    feedbacks = { { { "done_BEH_Mission_Automate_AssignerSeFaireTransporterA_DansZone" }, "BEH_Mission_Automate_AssignerSeFaireTransporterA_DansZone" } },
    SendFeedback = function( self, value ) Feedback( self.feedbacks.done_BEH_Mission_Automate_AssignerSeFaireTransporterA_DansZone, {value} ) end,
    activations =
    {
        { "BEH_Mission_Automate_AssignerSeFaireTransporterA", { "done_BEH_Mission_Automate_AssignerSeFaireTransporterA" } },
    },

    create = function( self )
        self._namedParams = {}
        self._namedParams.pion = self.params[1]
        self._namedParams.ptZone = self.params[2]
    end,

    activate = function( self )
        local Activate = Activate
        self.ptTransport = self.ptTransport or DEC_Geometrie_PositionAleatoireDansCercle( self._namedParams.ptZone, 100 )
        if( ModuleBegins() ) then
            StartActivateOverride( self, self.activations.BEH_Mission_Automate_AssignerSeFaireTransporterA, 1, { ePhase_MRT, self._namedParams.pion, self.ptTransport, } )
        end

    end,

}

eventmanager_plugin = eventmanager_plugin or {}
eventmanager_plugin.MIS_Automate_MRT_SeFaireTransporter = { "mission" }
connections = connections or {}
connections[ #connections + 1 ] = { nodes.BEH_Medo_Automate_FaireTransporter_DansZone, "BEH_Mission_Automate_AssignerSeFaireTransporterA_DansZone", nodes.BEH_Mission_Automate_AssignerSeFaireTransporterA_DansZone }
connections[ #connections + 1 ] = { nodes.BEH_Medo_Automate_PreparerMission_SeFaireTransporter, "BEH_Medo_Automate_ControleCreationMission", nodes.BEH_Medo_Automate_ControleCreationMission }
connections[ #connections + 1 ] = { nodes.BEH_Medo_Automate_PreparerMission_SeFaireTransporter, "BEH_Medo_Automate_FaireTransporter_DansZone", nodes.BEH_Medo_Automate_FaireTransporter_DansZone }
connections[ #connections + 1 ] = { nodes.BEH_Mission_Automate_AssignerSeFaireTransporterA_DansZone, "BEH_Mission_Automate_AssignerSeFaireTransporterA", nodes.BEH_Mission_Automate_AssignerSeFaireTransporterA }
connections[ #connections + 1 ] = { nodes.MIS_Automate_MRT_SeFaireTransporter, "BEH_Medo_Automate_PreparerMission_SeFaireTransporter", nodes.BEH_Medo_Automate_PreparerMission_SeFaireTransporter }
