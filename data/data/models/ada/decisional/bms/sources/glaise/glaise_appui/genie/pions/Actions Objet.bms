includedFiles = includedFiles or {}
includedFiles["sources/glaise/glaise_appui/genie/pions/Actions Objet.bms"] = true

include "bit.lua"


--[[// ****************************************************************************
]]--[[// ACT_Obj_Pion_GEN_RealiserTravaux
]]--[[//
]]--[[// Commentaires:
]]--[[//
]]--[[// ****************************************************************************
]]node "ACT_Obj_Pion_GEN_RealiserTravaux"
{
    actuators =
    {
        obstacle = 1,
        deplacement = 1,
    },

    create = function( self )
        self._namedParams = {}
        self._namedParams.objet = self.params[1]
    end,

    select = function( self )
        --[[//booleens suspension reprise et terminaison
]]        self.eActionObjet = self.eActionObjet or eActionObjetEnCours
        self.bSuspendu = self.bSuspendu or false
        self.bInit = self.bInit or true
        self.act = self.act or 0
        --[[//-----------------------------------------------------------------
]]--[[// Init
]]--[[//-----------------------------------------------------------------
]]if( ModuleBegins() ) then
            do
                if( not DEC_Agent_AutomateEstEmbraye() ) then
                    DEC_RC( eRC_OrganisationChantier )
                else
                    DEC_Message( eRC_OrganisationChantier )
                end

            end
--[[//-----------------------------------------------------------------
]]--[[// Début travaux
]]--[[//-----------------------------------------------------------------
]]        end

        if( self.bInit and DEC_Agent_NiveauInstallation() >= eNiveauInstallation_Poste ) then
            do
                if( DEC_GenObject_Type( self._namedParams.objet ) == eTypeObjectCampPrisonniers or DEC_GenObject_Type( self._namedParams.objet ) == eTypeObjectCampRefugies ) then
                    self.act = DEC_StartCreerObjet( myself.objMisEnCours_, DEC_GenObject_Type( self._namedParams.objet ), DEC_GenObject_IDPlanifie( self._namedParams.objet ), DEC_GenObject_Localisation( self._namedParams.objet ), DEC_GenObject_NomPlanifie( self._namedParams.objet ), DEC_GenObject_TC2( self._namedParams.objet ) )
                    actionCallbacks[ self.act ] = function( arg ) self.eActionObjet = arg end
                    actionKnowledgeCallbacks[ self.act ] = function( arg ) myself.objMisEnCours_ = arg end

                else
if( DEC_GenObject_Type( self._namedParams.objet ) == eTypeObjectZoneMineeLineaire or DEC_GenObject_Type( self._namedParams.objet ) == eTypeObjectZoneMineeParDispersion ) then
                        self.act = DEC_StartCreerObjet( myself.objMisEnCours_, DEC_GenObject_Type( self._namedParams.objet ), DEC_GenObject_IDPlanifie( self._namedParams.objet ), DEC_GenObject_Localisation( self._namedParams.objet ), DEC_GenObject_NomPlanifie( self._namedParams.objet ), DEC_GenObject_Densite( self._namedParams.objet ), DEC_GenObject_DelaiActiviteMines( self._namedParams.objet ) )
                        actionCallbacks[ self.act ] = function( arg ) self.eActionObjet = arg end
                        actionKnowledgeCallbacks[ self.act ] = function( arg ) myself.objMisEnCours_ = arg end

                    else
if( DEC_GenObject_Type( self._namedParams.objet ) == eTypeObjectBouchonMines ) then
                            self.act = DEC_StartCreerObjet( myself.objMisEnCours_, DEC_GenObject_Type( self._namedParams.objet ), DEC_GenObject_IDPlanifie( self._namedParams.objet ), DEC_GenObject_Localisation( self._namedParams.objet ), DEC_GenObject_NomPlanifie( self._namedParams.objet ), DEC_GenObject_DelaiActiviteMines( self._namedParams.objet ) )
                            actionCallbacks[ self.act ] = function( arg ) self.eActionObjet = arg end
                            actionKnowledgeCallbacks[ self.act ] = function( arg ) myself.objMisEnCours_ = arg end

                        else
                            --[[// Autres objets
]]self.act = DEC_StartCreerObjet( myself.objMisEnCours_, DEC_GenObject_Type( self._namedParams.objet ), DEC_GenObject_IDPlanifie( self._namedParams.objet ), DEC_GenObject_Localisation( self._namedParams.objet ), DEC_GenObject_NomPlanifie( self._namedParams.objet ) )
                            actionCallbacks[ self.act ] = function( arg ) self.eActionObjet = arg end
                            actionKnowledgeCallbacks[ self.act ] = function( arg ) myself.objMisEnCours_ = arg end

                        end
                    end
                end

                do
                    if( not DEC_Agent_AutomateEstEmbraye() ) then
                        DEC_RC( eRC_DebutTravaux )
                    else
                        DEC_Message( eRC_DebutTravaux )
                    end

                end

                self.bInit = false
            end
--[[//-----------------------------------------------------------------
]]--[[// RC éventuels
]]--[[//-----------------------------------------------------------------
]]        end

         do
            local _continue = true
            local switch_1 = self.eActionObjet
            local cases_switch_1 = {}
                if switch_1 == eActionObjetTerminee then
                    DEC_Trace( "  fin travaux " )
                    do
                        if( not DEC_Agent_AutomateEstEmbraye() ) then
                            DEC_RC( eRC_FinTravaux )
                        else
                            DEC_Message( eRC_FinTravaux )
                        end

                    end

                                        self.params.__returnValue = eActionEffectuee
                    do return end

                    _continue = false
                elseif switch_1 == eActionObjetManqueDotation
                or switch_1 == eActionObjetPasDeCapacite
                or switch_1 == eActionObjetImpossible then
                    DEC_Trace( "  travaux impossible " )
                    DEC_Trace( EnumToString( self.eActionObjet, E_EtatActionObjet ) )
                                        self.params.__returnValue = eActionEffectuee
                    do return end

                    _continue = false
                                end
            end
--[[//-----------------------------------------------------------------
]]--[[// Reprise si suspendu
]]--[[//-----------------------------------------------------------------
]]
        if( self.bSuspendu and DEC_Agent_NiveauInstallation() >= eNiveauInstallation_Poste ) then
            do
                DEC_ReprendAction( self.act )
                self.bSuspendu = false
            end
        end

    end,

    deselect = function( self )
                DEC_PauseAction( self.act )
        self.bSuspendu = true
    end,

    destroy = function( self )
                DEC_StopAction( self.act )
    end,

}

--[[// ******************************************************************************
]]--[[// ACT_Obj_Pion_GEN_PreparerObstacle
]]--[[//
]]--[[// Commentaires: pour obstacle de manoeuvre
]]--[[//
]]--[[// ******************************************************************************
]]node "ACT_Obj_Pion_GEN_PreparerObstacle"
{
    actuators =
    {
        obstacle = 1,
        deplacement = 1,
    },

    create = function( self )
        self._namedParams = {}
        self._namedParams.obstacle = self.params[1]
    end,

    select = function( self )
        --[[//booleens suspension reprise et terminaison
]]        self.eActionObjet = self.eActionObjet or eActionObjetEnCours
        self.bSuspendu = self.bSuspendu or false
        self.bInit = self.bInit or true
        self.act = self.act or 0
        --[[//-----------------------------------------------------------------
]]--[[// Init
]]--[[//-----------------------------------------------------------------
]]if( ModuleBegins() ) then
            do
                if( not DEC_Agent_AutomateEstEmbraye() ) then
                    DEC_RC( eRC_OrganisationChantier )
                else
                    DEC_Message( eRC_OrganisationChantier )
                end

            end
--[[//-----------------------------------------------------------------
]]--[[// Début creation objet
]]--[[//-----------------------------------------------------------------
]]        end

        if( self.bInit and DEC_Agent_NiveauInstallation() >= eNiveauInstallation_Poste ) then
            do
                self.act = DEC_StartPreparerObjet( myself.objMisEnCours_, DEC_GenObject_Type( self._namedParams.obstacle ), DEC_GenObject_IDPlanifie( self._namedParams.obstacle ), DEC_GenObject_Localisation( self._namedParams.obstacle ), DEC_GenObject_NomPlanifie( self._namedParams.obstacle ), DEC_GenObject_Densite( self._namedParams.obstacle ) )
                actionCallbacks[ self.act ] = function( arg ) self.eActionObjet = arg end
                actionKnowledgeCallbacks[ self.act ] = function( arg ) myself.objMisEnCours_ = arg end

                                do
                    if( not DEC_Agent_AutomateEstEmbraye() ) then
                        DEC_RC( eRC_DebutTravaux )
                    else
                        DEC_Message( eRC_DebutTravaux )
                    end

                end

                DEC_Trace( "Creation objet prepare: debut" )
                self.bInit = false
            end
--[[//-----------------------------------------------------------------
]]--[[// RC éventuels
]]--[[//-----------------------------------------------------------------
]]        end

         do
            local _continue = true
            local switch_1 = self.eActionObjet
            local cases_switch_1 = {}
                if switch_1 == eActionObjetTerminee then
                    do
                        if( not DEC_Agent_AutomateEstEmbraye() ) then
                            DEC_RC( eRC_FinTravaux )
                        else
                            DEC_Message( eRC_FinTravaux )
                        end

                    end

                                        self.params.__returnValue = eActionEffectuee
                    do return end

                                end
                if cases_switch_1[1] or switch_1 == eActionObjetPasDeCapacite
                or switch_1 == eActionObjetImpossible
                or switch_1 == eActionObjetManqueDotation then
                    DEC_Trace( "Impossible de contruire l'objet" )
                                        self.params.__returnValue = eActionEffectuee
                    do return end

                    _continue = false
                                end
            end
--[[//-----------------------------------------------------------------
]]--[[// Reprise si suspendu
]]--[[//-----------------------------------------------------------------
]]
        if( self.bSuspendu and DEC_Agent_NiveauInstallation() >= eNiveauInstallation_Poste ) then
            do
                DEC_ReprendAction( self.act )
                self.bSuspendu = false
            end
        end

    end,

    deselect = function( self )
                DEC_PauseAction( self.act )
        self.bSuspendu = true
    end,

    destroy = function( self )
                DEC_StopAction( self.act )
    end,

}

--[[// ******************************************************************************
]]--[[// ACT_Obj_Pion_GEN_ActiverObstacle
]]--[[//
]]--[[// Commentaires:
]]--[[//
]]--[[// Revision MIA
]]--[[//
]]--[[// ******************************************************************************
]]node "ACT_Obj_Pion_GEN_ActiverObstacle"
{
    create = function( self )
        self._namedParams = {}
        self._namedParams.repObj = self.params[1]
    end,

    select = function( self )
        --[[//-----------------------------------------------------------------
]]--[[// Init
]]--[[//-----------------------------------------------------------------
]]if( ModuleBegins() ) then
            DEC_Trace( "  Activation obstacle" )
        end

        --[[//-----------------------------------------------------------------
]]--[[// Activation // MIA c'est ici qu'il faut renvoyer l'info! Il faut
]]--[[// une fonction : DEC_PeutActiverObstacle()
]]--[[//-----------------------------------------------------------------
]]if( DEC_ActiverObjet( self._namedParams.repObj ) ) then
            do
                DEC_Trace( "  fin activation " )
                                self.params.__returnValue = eActionEffectuee
                do return end

            end
        else
            self.params.__returnValue = eActionImpossible
            do return end
        end

    end,

}

--[[// ******************************************************************************
]]--[[// ACT_Obj_Pion_GEN_ValoriserObstacle()
]]--[[//
]]--[[// Commentaires:
]]--[[//
]]--[[// Révision MIA
]]--[[//
]]--[[// ******************************************************************************
]]node "ACT_Obj_Pion_GEN_ValoriserObstacle"
{
    actuators =
    {
        obstacle = 1,
    },

    create = function( self )
        self._namedParams = {}
        self._namedParams.repObj = self.params[1]
    end,

    select = function( self )
        --[[//booleens suspension reprise et terminaison
]]        self.eActionObjet = self.eActionObjet or eActionObjetEnCours
        self.bSuspendu = self.bSuspendu or false
        self.bInit = self.bInit or true
        self.act = self.act or 0
        --[[//-----------------------------------------------------------------
]]--[[// Init
]]--[[//-----------------------------------------------------------------
]]if( ModuleBegins() ) then
            do
                if( not DEC_Agent_AutomateEstEmbraye() ) then
                    DEC_RC( eRC_OrganisationChantier )
                else
                    DEC_Message( eRC_OrganisationChantier )
                end

            end
--[[//-----------------------------------------------------------------
]]--[[// Début creation objet
]]--[[//-----------------------------------------------------------------
]]        end

        if( self.bInit and DEC_Agent_NiveauInstallation() >= eNiveauInstallation_Poste ) then
            do
                self.act = DEC_StartValoriserObjet( self._namedParams.repObj )
                actionCallbacks[ self.act ] = function( arg ) self.eActionObjet = arg end

                                do
                    if( not DEC_Agent_AutomateEstEmbraye() ) then
                        DEC_RC( eRC_DebutTravaux )
                    else
                        DEC_Message( eRC_DebutTravaux )
                    end

                end

                DEC_Trace( "----- Valorisation: debut ----" )
                self.bInit = false
            end
--[[//-----------------------------------------------------------------
]]--[[// RC éventuels
]]--[[//-----------------------------------------------------------------
]]        end

         do
            local _continue = true
            local switch_1 = self.eActionObjet
            local cases_switch_1 = {}
                if switch_1 == eActionObjetTerminee then
                    do
                        if( not DEC_Agent_AutomateEstEmbraye() ) then
                            DEC_RC( eRC_FinTravaux )
                        else
                            DEC_Message( eRC_FinTravaux )
                        end

                    end

                                        self.params.__returnValue = eActionEffectuee
                    do return end

                                end
                if cases_switch_1[1] or switch_1 == eActionObjetPasDeCapacite
                or switch_1 == eActionObjetImpossible
                or switch_1 == eActionObjetManqueDotation then
                    DEC_Trace( "Impossible de valoriser l'objet" )
                                        self.params.__returnValue = eActionEffectuee
                    do return end

                    _continue = false
                                end
            end
--[[//-----------------------------------------------------------------
]]--[[// Reprise si suspendu
]]--[[//-----------------------------------------------------------------
]]
        if( self.bSuspendu and DEC_Agent_NiveauInstallation() >= eNiveauInstallation_Poste ) then
            do
                DEC_ReprendAction( self.act )
                self.bSuspendu = false
            end
        end

    end,

    deselect = function( self )
                DEC_PauseAction( self.act )
        self.bSuspendu = true
    end,

    destroy = function( self )
                DEC_StopAction( self.act )
    end,

}

--[[// ******************************************************************************
]]--[[// ACT_Obj_Pion_GEN_ReduireObstacle
]]--[[//
]]--[[// Commentaires:
]]--[[//
]]--[[// ******************************************************************************
]]node "ACT_Obj_Pion_GEN_ReduireObstacle"
{
    actuators =
    {
        obstacle = 1,
        deplacement = 1,
    },

    create = function( self )
        self._namedParams = {}
        self._namedParams.repObj = self.params[1]
    end,

    select = function( self )
        --[[//booleens suspension reprise et terminaison
]]        self.eActionObjet = self.eActionObjet or eActionObjetEnCours
        self.bSuspendu = self.bSuspendu or false
        self.bInit = self.bInit or true
        self.act = self.act or 0
        --[[//-----------------------------------------------------------------
]]--[[// Init
]]--[[//-----------------------------------------------------------------
]]if( ModuleBegins() ) then
            do
                if( not DEC_Agent_AutomateEstEmbraye() ) then
                    DEC_RC( eRC_OrganisationChantier )
                else
                    DEC_Message( eRC_OrganisationChantier )
                end

            end
--[[//-----------------------------------------------------------------
]]--[[// Début creation objet
]]--[[//-----------------------------------------------------------------
]]        end

        if( self.bInit and DEC_Agent_NiveauInstallation() >= eNiveauInstallation_Poste ) then
            do
                self.act = DEC_StartDetruireObjet( self._namedParams.repObj )
                actionCallbacks[ self.act ] = function( arg ) self.eActionObjet = arg end

                                do
                    if( not DEC_Agent_AutomateEstEmbraye() ) then
                        DEC_RC( eRC_DebutTravaux )
                    else
                        DEC_Message( eRC_DebutTravaux )
                    end

                end

                DEC_Trace( "Début destruction" )
                self.bInit = false
            end
--[[//-----------------------------------------------------------------
]]--[[// RC éventuels
]]--[[//-----------------------------------------------------------------
]]        end

         do
            local _continue = true
            local switch_1 = self.eActionObjet
            local cases_switch_1 = {}
                if switch_1 == eActionObjetTerminee then
                    do
                        if( not DEC_Agent_AutomateEstEmbraye() ) then
                            DEC_RC( eRC_FinTravaux )
                        else
                            DEC_Message( eRC_FinTravaux )
                        end

                    end

                                        self.params.__returnValue = eActionEffectuee
                    do return end

                                end
                if cases_switch_1[1] or switch_1 == eActionObjetPasDeCapacite
                or switch_1 == eActionObjetImpossible
                or switch_1 == eActionObjetManqueDotation then
                    DEC_Trace( "Impossible de détruire l'objet" )
                    _continue = false
                                cases_switch_1[2] = true
                end
            end
--[[//-----------------------------------------------------------------
]]--[[// Reprise si suspendu
]]--[[//-----------------------------------------------------------------
]]
        if( self.bSuspendu and DEC_Agent_NiveauInstallation() >= eNiveauInstallation_Poste ) then
            do
                DEC_ReprendAction( self.act )
                self.bSuspendu = false
            end
        end

    end,

    deselect = function( self )
                DEC_PauseAction( self.act )
        self.bSuspendu = true
    end,

    destroy = function( self )
                DEC_StopAction( self.act )
    end,

}

--[[// ******************************************************************************
]]--[[// ACT_Obj_Pion_GEN_CreerContournement
]]--[[//
]]--[[// Commentaires: coefficient de gain de contournement
]]--[[//
]]--[[// ******************************************************************************
]]node "ACT_Obj_Pion_GEN_CreerContournement"
{
    actuators =
    {
        obstacle = 1,
        deplacement = 1,
    },

    create = function( self )
        self._namedParams = {}
        self._namedParams.repObj = self.params[1]
    end,

    select = function( self )
        --[[//booleens suspension reprise et terminaison
]]        self.eActionObjet = self.eActionObjet or eActionObjetEnCours
        self.bSuspendu = self.bSuspendu or false
        self.bInit = self.bInit or true
        self.act = self.act or 0
        --[[//-----------------------------------------------------------------
]]--[[// Init
]]--[[//-----------------------------------------------------------------
]]if( ModuleBegins() ) then
            do
                if( not DEC_Agent_AutomateEstEmbraye() ) then
                    DEC_RC( eRC_OrganisationChantier )
                else
                    DEC_Message( eRC_OrganisationChantier )
                end

            end
--[[//-----------------------------------------------------------------
]]--[[// Début contournement
]]--[[//-----------------------------------------------------------------
]]        end

        if( self.bInit and DEC_Agent_NiveauInstallation() >= eNiveauInstallation_Poste ) then
            do
                self.act = DEC_StartCreerContournementObjet( self._namedParams.repObj )
                actionCallbacks[ self.act ] = function( arg ) self.eActionObjet = arg end

                                do
                    if( not DEC_Agent_AutomateEstEmbraye() ) then
                        DEC_RC( eRC_DebutTravaux )
                    else
                        DEC_Message( eRC_DebutTravaux )
                    end

                end

                self.bInit = false
            end
--[[//-----------------------------------------------------------------
]]--[[// RC éventuels
]]--[[//-----------------------------------------------------------------
]]        end

         do
            local _continue = true
            local switch_1 = self.eActionObjet
            local cases_switch_1 = {}
                if switch_1 == eActionObjetTerminee then
                    do
                        if( not DEC_Agent_AutomateEstEmbraye() ) then
                            DEC_RC( eRC_ContournementRealise )
                        else
                            DEC_Message( eRC_ContournementRealise )
                        end

                    end

                                        self.params.__returnValue = eActionEffectuee
                    do return end

                                end
                if cases_switch_1[1] or switch_1 == eActionObjetManqueDotation
                or switch_1 == eActionObjetPasDeCapacite
                or switch_1 == eActionObjetImpossible then
                    DEC_Trace( "contournement impossible " )
                    _continue = false
                                cases_switch_1[2] = true
                end
            end
--[[//-----------------------------------------------------------------
]]--[[// Reprise si suspendu
]]--[[//-----------------------------------------------------------------
]]
        if( self.bSuspendu and DEC_Agent_NiveauInstallation() >= eNiveauInstallation_Poste ) then
            do
                DEC_ReprendAction( self.act )
                self.bSuspendu = false
            end
        end

    end,

    deselect = function( self )
                DEC_PauseAction( self.act )
        self.bSuspendu = true
    end,

    destroy = function( self )
                DEC_StopAction( self.act )
    end,

}

--[[// ******************************************************************************
]]--[[// ACT_Obj_Pion_GEN_ReprendreTravaux
]]--[[//
]]--[[// Commentaires:
]]--[[//
]]--[[// ******************************************************************************
]]node "ACT_Obj_Pion_GEN_ReprendreTravaux"
{
    actuators =
    {
        obstacle = 1,
        deplacement = 1,
    },

    create = function( self )
        self._namedParams = {}
        self._namedParams.repObj = self.params[1]
    end,

    select = function( self )
        --[[//booleens suspension reprise et terminaison
]]        self.eActionObjet = self.eActionObjet or eActionObjetEnCours
        self.bSuspendu = self.bSuspendu or false
        self.bInit = self.bInit or true
        self.act = self.act or 0
        --[[//-----------------------------------------------------------------
]]--[[// Init
]]--[[//-----------------------------------------------------------------
]]if( ModuleBegins() ) then
            do
                if( not DEC_Agent_AutomateEstEmbraye() ) then
                    DEC_RC( eRC_OrganisationChantier )
                else
                    DEC_Message( eRC_OrganisationChantier )
                end

            end
--[[//-----------------------------------------------------------------
]]--[[// Début contournement
]]--[[//-----------------------------------------------------------------
]]        end

        if( self.bInit and DEC_Agent_NiveauInstallation() >= eNiveauInstallation_Poste ) then
            do
                DEC_Trace( "  reprise realisation obstacle: " )
                self.act = DEC_StartReprendreTravauxObjet( self._namedParams.repObj )
                actionCallbacks[ self.act ] = function( arg ) self.eActionObjet = arg end

                                do
                    if( not DEC_Agent_AutomateEstEmbraye() ) then
                        DEC_RC( eRC_DebutTravaux )
                    else
                        DEC_Message( eRC_DebutTravaux )
                    end

                end

                self.bInit = false
            end
--[[//-----------------------------------------------------------------
]]--[[// RC éventuels
]]--[[//-----------------------------------------------------------------
]]        end

         do
            local _continue = true
            local switch_1 = self.eActionObjet
            local cases_switch_1 = {}
                if switch_1 == eActionObjetTerminee then
                    do
                        if( not DEC_Agent_AutomateEstEmbraye() ) then
                            DEC_RC( eRC_FinTravaux )
                        else
                            DEC_Message( eRC_FinTravaux )
                        end

                    end

                                        self.params.__returnValue = eActionEffectuee
                    do return end

                                end
                if cases_switch_1[1] or switch_1 == eActionObjetManqueDotation
                or switch_1 == eActionObjetPasDeCapacite
                or switch_1 == eActionObjetImpossible then
                    DEC_Trace( "contournement impossible " )
                    _continue = false
                                cases_switch_1[2] = true
                end
            end
--[[//-----------------------------------------------------------------
]]--[[// Reprise si suspendu
]]--[[//-----------------------------------------------------------------
]]
        if( self.bSuspendu and DEC_Agent_NiveauInstallation() >= eNiveauInstallation_Poste ) then
            do
                DEC_ReprendAction( self.act )
                self.bSuspendu = false
            end
        end

    end,

    deselect = function( self )
                DEC_PauseAction( self.act )
        self.bSuspendu = true
    end,

    destroy = function( self )
                DEC_StopAction( self.act )
    end,

}

