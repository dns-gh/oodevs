includedFiles = includedFiles or {}
includedFiles["sources/glaise/glaise_melee/abc/pions/common/Actions.bms"] = true

include "bit.lua"


--[[// *****************************************************************************
]]--[[//
]]--[[// $Created: MIA 02-11-08 $
]]--[[// $Archive: /MVW_v10/Build/Data/Data/Modeles/Sources/Melee/Abc/Pions/Common/Actions.hal $
]]--[[// $Author: Ggr $
]]--[[// $Modtime: 22/08/05 16:07 $
]]--[[// $Revision: 10 $
]]--[[// $Workfile: Actions.hal $
]]--[[//
]]--[[// *****************************************************************************
]]

--[[// *****************************************************************************
]]--[[// ACT_Tir_Pion_ABC_FaireFeuSur
]]--[[//
]]--[[//Commentaires :
]]--[[//
]]--[[// *****************************************************************************
]]node "ACT_Tir_Pion_ABC_FaireFeuSur"
{
    feedbacks = { { { "done_ACT_Tir_Pion_ABC_FaireFeuSur" }, "ACT_Tir_Pion_ABC_FaireFeuSur" } },
    SendFeedback = function( self, value ) Feedback( self.feedbacks.done_ACT_Tir_Pion_ABC_FaireFeuSur, {value} ) end,
    actuators =
    {
        tir = 1,
    },

    create = function( self )
        self._namedParams = {}
        self._namedParams.repEni = self.params[1]
        self._namedParams.pourcentageComposantes = self.params[2]
    end,

    select = function( self )
                self.bTir = self.bTir or false
        self.actionTir = self.actionTir or 0--[[//handler sur l'action
]]
        self.eTir = self.eTir or nil
        if( ModuleBegins() ) then
            DEC_Trace( ">>........ PREPARATION TIR ........<<" )
        end

        if( ( DEC_Agent_NiveauInstallation() >= eNiveauInstallation_PosteReflexe ) and ( not self.bTir ) ) then
            do
                self.bTir = true
                DEC_Trace( ">> Ouverture du feu" )
                F_Pion_SeteEtatFeu( myself, eEtatFeu_Executer )
                self.actionTir = DEC_StartTirDirect( self._namedParams.repEni, self._namedParams.pourcentageComposantes, eTirDirectNormal )
                actionCallbacks[ self.actionTir ] = function( arg ) self.eTir = arg end

            end
        end

    end,

    deselect = function( self )
                F_Pion_SeteEtatFeu( myself, eEtatFeu_aucun )
        if( self.actionTir ~= nil ) then
            DEC_StopAction( self.actionTir )
        end

        DEC_Trace( "Fin ouverture du feu" )
                self:SendFeedback( eActionHalt )
        Halt( self )
        do return end

    end,

    destroy = function( self )
                F_Pion_SeteEtatFeu( myself, eEtatFeu_aucun )
        if( self.actionTir ~= nil ) then
            DEC_StopAction( self.actionTir )
        end

    end,

}

