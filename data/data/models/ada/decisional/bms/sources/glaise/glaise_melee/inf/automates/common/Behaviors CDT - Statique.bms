includedFiles = includedFiles or {}
includedFiles["sources/glaise/glaise_melee/inf/automates/common/Behaviors CDT - Statique.bms"] = true

include "bit.lua"


--[[// *****************************************************************************
]]--[[//
]]--[[// $Created: JCR 03-05-15 $
]]--[[// $Archive: /MVW_v10/Build/Data/Data/Modeles/Sources/Melee/Inf/Automates/Common/Behaviors CDT - Statique.hal $
]]--[[// $Author: Ggr $
]]--[[// $Modtime: 24/05/05 13:56 $
]]--[[// $Revision: 9 $
]]--[[// $Workfile: Behaviors CDT - Statique.hal $
]]--[[//
]]--[[// *****************************************************************************
]]


node "BEH_Situation_Automate_INF_CadreDefensif_InstallerPC"
{
    feedbacks = { { { "done_BEH_Situation_Automate_INF_CadreDefensif_InstallerPC" }, "BEH_Situation_Automate_INF_CadreDefensif_InstallerPC" } },
    SendFeedback = function( self, value ) Feedback( self.feedbacks.done_BEH_Situation_Automate_INF_CadreDefensif_InstallerPC, {value} ) end,
    activations =
    {
        { "BEH_Conduite_Automate_INF_AssignerMission_PC", { "done_BEH_Conduite_Automate_INF_AssignerMission_PC" } },
    },

    create = function( self )
    end,

    activate = function( self )
        local Activate = Activate
         do
            local _continue = true
--[[// Situation Mission
]]--[[// --------------------------------------------------------------------
]]            local switch_1 = F_Automat_GeteEtatPhaseMission( myself )
                if switch_1 == eEtatPhaseMission_InstallationDispositif
                or switch_1 == eEtatPhaseMission_EnSurveillance then
                    Activate( self.activations.BEH_Conduite_Automate_INF_AssignerMission_PC, 1, { "T_Mission_Pion_FaireMouvement", } )
                    _continue = false
                
                else
                    Activate( self.activations.BEH_Conduite_Automate_INF_AssignerMission_PC, 1, { "T_Mission_Pion_Suivre", } )
                end
            end

    end,

--[[//-----------------------------------------------------------------------------
]]--[[// PC
]]--[[//-----------------------------------------------------------------------------    	
]]}

node "BEH_Conduite_Automate_INF_AssignerMission_PC"
{
    feedbacks = { { { "done_BEH_Conduite_Automate_INF_AssignerMission_PC" }, "BEH_Conduite_Automate_INF_AssignerMission_PC" } },
    SendFeedback = function( self, value ) Feedback( self.feedbacks.done_BEH_Conduite_Automate_INF_AssignerMission_PC, {value} ) end,
    activations =
    {
        { "BEH_Mission_Automate_AssignerSuivreA", { "done_BEH_Mission_Automate_AssignerSuivreA" } },
        { "BEH_Mission_Automate_AssignerFaireMouvementA", { "done_BEH_Mission_Automate_AssignerFaireMouvementA" } },
    },

    create = function( self )
        self._namedParams = {}
        self._namedParams.eMission = self.params[1]
    end,

    activate = function( self )
        local Activate = Activate
        self.ptStatique = self.ptStatique or nil
        self.pAppui = self.pAppui or nil
        self.pFoo = self.pFoo or nil
        local selPions_PE = S_ObtenirPionsDe_SansPC( eEtatEchelon_Premier, eEtatDestruction_None )
        local selPions_SE = S_ObtenirTousPionsDe_SansPC( eEtatEchelon_Second )
        if( ModuleBegins() or self.pAppui == nil ) then
            do
                --[[//-----------------------------------------------------------------------------
]]--[[// Init
]]--[[//-----------------------------------------------------------------------------    			    
]]if( #( selPions_SE ) ~= 0 ) then
                    self.pAppui = DIA_GetAt( selPions_SE, Floor( #( selPions_SE ) / 2 ) )
                else
                    self.pAppui = DIA_GetAt( selPions_PE, Floor( #( selPions_PE ) / 2 ) )
                end

                if( self.pAppui == nil ) then
                    do return end
                end

                 do
                    local _continue = true
                    local switch_1 = self._namedParams.eMission
                        if switch_1 == "T_Mission_Pion_Suivre" then
                            Activate( self.activations.BEH_Mission_Automate_AssignerSuivreA, 1, { ePhase_CDT, DEC_Automate_PionPC(), self.pAppui, } )
                            _continue = false
                        elseif switch_1 == "T_Mission_Pion_FaireMouvement" then
                            if( F_Pion_GeteEtatPhaseMission( self.pAppui ) ~= eEtatPhaseMission_InstallationDispositif ) then
                                do
                                    self.pAppui = self.pFoo
                                                                        do return end

                                end
                            end

                            local mission = DEC_GetMission( myself )
                            self.ptStatique = S_Geometrie_PtInvDirDangereuse( DEC_Automate_PionPosition( self.pAppui ), DEC_GetDirectionEnnemi( mission ), 1263 )
                            Activate( self.activations.BEH_Mission_Automate_AssignerFaireMouvementA, 1, { ePhase_CDT, DEC_Automate_PionPC(), self.ptStatique, eEtatEchelon_Second, } )
                            _continue = false
                                                end
                    end

            end
        end

    end,

}

connections = connections or {}
connections[ #connections + 1 ] = { nodes.BEH_Conduite_Automate_INF_AssignerMission_PC, "BEH_Mission_Automate_AssignerSuivreA", nodes.BEH_Mission_Automate_AssignerSuivreA }
connections[ #connections + 1 ] = { nodes.BEH_Conduite_Automate_INF_AssignerMission_PC, "BEH_Mission_Automate_AssignerFaireMouvementA", nodes.BEH_Mission_Automate_AssignerFaireMouvementA }
connections[ #connections + 1 ] = { nodes.BEH_Situation_Automate_INF_CadreDefensif_InstallerPC, "BEH_Conduite_Automate_INF_AssignerMission_PC", nodes.BEH_Conduite_Automate_INF_AssignerMission_PC }
