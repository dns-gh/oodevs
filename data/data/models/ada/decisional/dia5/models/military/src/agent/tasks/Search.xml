<?xml version="1.0" encoding="UTF-8"?>
<task xmlns="http://www.masagroup.net/directia/schemas/bm" name="agent.tasks.Search" source-version="1.0.0" knowledge-class="agent.tasks.knowledges.Search">
	<description>
        Ratisser des objectifs par ordre de priorité.
    </description>
	<parameters>
		<parameter name="objectives">
			<description>Les objectifs à fouiller.</description>
			<type>
				<list>
					<class name="world_concepts.Searchable"/>
					<class name="world_concepts.Reconnoitring"/>
				</list>
			</type>
		</parameter>
	</parameters>
	<goal>
		<description>Fouiller les objectifs passés en paramètre.</description>
	</goal>
	<stages>
		<stage label="Fouille des objectifs" disable-when-done="true">
			<description>Mouvement tactique et reonnaissance des objectifs. Détection des ennemis, prise de contact si possible.</description>
			<goal>
				<description>Obtenir des informations sur les objectifs avec agressivité.</description>
			</goal>
			<let name="entitiesToEngage">
				<value>
					<call method="queries_enemies.getEnemiesInRange">
						<parameter name="probabilityToHit">
							<value>
								<number>0.5</number>
							</value>
						</parameter>
					</call>
				</value>
			</let>
			<skills>
				<skill name="agent.skills.primitives.Search" main="true" priority="0.9">
					<parameter name="entities">
						<value>
							<parameter>objectives</parameter>
						</value>
					</parameter>
					<parameter name="positions">
						<value>
							<parameter>objectives</parameter>
						</value>
					</parameter>
				</skill>
				<skill name="agent.skills.Engage" priority="0.1">
					<parameter name="entities">
						<value>
							<parameter>entitiesToEngage</parameter>
						</value>
					</parameter>
					<parameter name="positions">
						<value>
							<call method="queries_positions.getPositionsToDestroy">
								<parameter name="elementsToDestroy">
									<value>
										<parameter>entitiesToEngage</parameter>
									</value>
								</parameter>
							</call>
						</value>
					</parameter>
				</skill>
			</skills>
		</stage>
	</stages>
</task>