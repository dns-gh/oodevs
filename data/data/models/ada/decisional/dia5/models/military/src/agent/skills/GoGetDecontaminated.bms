-- **************************************************************************** 
-- To get decontaminated by a decontamination plot
-- ****************************************************************************
rootnode
{
    connections = { skill.links.moveToward, skill.links.getDecontaminated },

    -- -------------------------------------------------------------------------------- 
    -- feedback from moveToward
    -- --------------------------------------------------------------------------------
    done = function( self, params, additionnalParams )
       Feedback( self.feedbacks.done ) -- meeting point has been reached
    end,

    -- -------------------------------------------------------------------------------- 
    -- feedback from GetDecon
    -- --------------------------------------------------------------------------------
    isDecontaminated = function( self, params )
        self.decontaminated = true
    end,

    -- -------------------------------------------------------------------------------- 
    -- Init 
    -- --------------------------------------------------------------------------------
    create = function( self )
        self.decontaminated = false
        meKnowledge:forcerImmunisationNbc( true ) -- Magic immunization for NBC contamination
    end,

    -- -------------------------------------------------------------------------------- 
    -- Select nearest plot and move toward it, asking for decontamination
    -- --------------------------------------------------------------------------------
    activate = function( self )
        local Activate = Activate

        if not self.decontaminated then
            Activate( skill.links.getDecontaminated, 1, { decontaminationPlot = self.params.decontaminationPlot } )
        else
            Activate( skill.links.moveToward, 1, { entities = { self.params.meetingPoint } } )
        end
    end,

    destroy = function( self )
         meKnowledge:forcerImmunisationNbc( false )  -- End of magic immunization for NBC contamination
    end
}