-- ****************************************************************************
-- To operate an entity
-- @params: self.params.entity, a masalife 'Entity' object
-- Uses the primitive skill "moveToward" on reach the object and operate it. 
-- ****************************************************************************
rootnode 
{
    connections = { skill.links.moveToward, skill.nodes.Operate },

    -- --------------------------------------------------------------------------------
    -- Feedbacks and slots
    -- --------------------------------------------------------------------------------
    impossibleToOperate = function( self, params ) -- called within this skill
        meKnowledge:RC( eRC_ImpossibleToOperateObject )
        meKnowledge:sendMessage( "The object is saturated or it cannot be operated" )
        -- Feedback( self.feedbacks.failed, params )
    end,

    done = function( self, params ) -- called by moveToward skill
        self.arrived = true
    end,

    -- --------------------------------------------------------------------------------
    -- Init
    -- --------------------------------------------------------------------------------
    create = function( self )
        self.arrived = false
        self.positions = queries.getPointsAroundObject[ "execute" ]( { object = self.params.entity } )
    end,

    -- --------------------------------------------------------------------------------
    -- Move to system and operate it.
    -- --------------------------------------------------------------------------------
    activate = function( self )
        local Activate = Activate

        if self.arrived then
            if self.params.entity:canAnimateIt() then
                Activate( skill.nodes.Operate, 1, { entity = self.params.entity } )
            else
                self:impossibleToOperate()
            end
        end

        Activate( skill.links.moveToward, 1, { entities = { self.params.entity }, positions = self.positions } )
        self.arrived = false
    end
}

-- ****************************************************************************
-- To operate a any kind of objcts that can be activated
-- @params: self.params.entity, a masalife 'animatable' object
-- @returns: operateActionRunning once action is running
-- ****************************************************************************
node "Operate"
{
    feedbacks = { "operateActionRunning" },

    select = function( self )
        if self.params.entity:animateIt() then
            Feedback( self.feedbacks.operateActionRunning )
        end
    end
}