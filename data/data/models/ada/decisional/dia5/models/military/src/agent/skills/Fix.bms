-- **************************************************************************** 
-- Fix entities
-- **************************************************************************** 
rootnode
{
   connections = { skill.links.engage, skill.links.moveToward },

    done = function( self ) end,

    -- -------------------------------------------------------------------------------- 
    -- Select the moving entities and angage them
    -- --------------------------------------------------------------------------------
   activate = function( self )
       local Activate = Activate
       self.movingEntities = {}
       for _, element in pairs( self.params.entities ) do
           if element:isMoving() then
               self.movingEntities[ #self.movingEntities + 1 ] = element
           end
       end
       if #self.movingEntities == 0 then
           Activate( skill.links.moveToward, 1, { entities  = self.params.entities,
                                                  positions = self.params.positions } )
       else
           Activate( skill.links.engage, 1, { entities  = self.movingEntities,
                                              positions = self.params.positions } )
       end
   end
}