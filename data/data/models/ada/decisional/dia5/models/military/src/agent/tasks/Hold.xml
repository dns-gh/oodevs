<?xml version="1.0" encoding="UTF-8"?>
<task xmlns="http://www.masagroup.net/directia/schemas/bm" name="agent.tasks.Hold" source-version="1.0.0" knowledge-class="agent.tasks.knowledges.Hold">
	<description>Tenir l'objectif passé en paramètre.</description>
	<parameters>
		<parameter name="objectives">
			<description>L'objectif à tenir.</description>
			<type>
				<list>
					<class name="world_concepts.Destroying"/>
				</list>
			</type>
		</parameter>
		<parameter name="obstacles" nullable="true">
			<description>Le plan d'obstacle à construire si nécéssaire.</description>
			<type>
				<list>
					<class name="world_concepts.Buildable"/>
					<class name="world_concepts.Building"/>
				</list>
			</type>
			<default>
				<nil/>
			</default>
		</parameter>
		<parameter name="withImprovement">
			<description>Si la valeur est vraie, on continue la construction en valorisant l'objectif.</description>
			<type>
				<simple name="boolean"/>
			</type>
		</parameter>
	</parameters>
	<goal>
		<description>Attendre et occuper l'objectif. Engager les ennemis menaçant.</description>
	</goal>
	<let name="enemiesAround">
		<value>
			<call method="queries_enemies.getEnemiesInRange">
				<parameter name="probabilityToHit">
					<value>
						<number>0.5</number>
					</value>
				</parameter>
			</call>
		</value>
	</let>
	<stages>
		<stage label="Preparation du terrain">
			<description>Building obstacles.</description>
			<goal>
				<description>Construire les obstacles.</description>
			</goal>
			<skills>
				<skill name="agent.skills.BuildWithoutReinforcement" main="true">
					<parameter name="entities">
						<value>
							<parameter>obstacles</parameter>
						</value>
					</parameter>
					<parameter name="withImprovement">
						<value>
							<parameter>withImprovement</parameter>
						</value>
					</parameter>
				</skill>
			</skills>
		</stage>
		<stage label="Occupation de l'objectif" permanent="true">
			<description>Occuper l'objectif en étant agressif.</description>
			<goal>
				<description>Engager tous les ennemis qui approchent de la position.</description>
			</goal>
			<skills>
				<skill name="agent.skills.MoveToward" priority="0.9">
					<parameter name="entities">
						<value>
							<parameter>objectives</parameter>
						</value>
					</parameter>
				</skill>
				<skill name="agent.skills.Engage" priority="0.1">
					<parameter name="entities">
						<value>
							<parameter>enemiesAround</parameter>
						</value>
					</parameter>
					<parameter name="positions">
						<value>
							<parameter>objectives</parameter>
						</value>
					</parameter>
				</skill>
			</skills>
		</stage>
	</stages>
</task>