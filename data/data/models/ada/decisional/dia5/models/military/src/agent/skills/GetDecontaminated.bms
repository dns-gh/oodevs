-- **************************************************************************** 
-- GetDecon
-- Usue motoward
-- ****************************************************************************
rootnode
{
    connections = { skill.links.moveToward, skill.nodes.RequestDecontamination },

    -- -------------------------------------------------------------------------------- 
    -- feedback from moveToward
    -- --------------------------------------------------------------------------------
    done = function( self, params, additionnalParams )
        self.arrived = true
    end,

    -- -------------------------------------------------------------------------------- 
    -- Init 
    -- --------------------------------------------------------------------------------
    create = function( self )
        self.arrived = false
    end,

    -- -------------------------------------------------------------------------------- 
    -- Select nearest plot and move toward it, asking for decontamination
    -- --------------------------------------------------------------------------------
    activate = function( self )
        local Activate = Activate

        -- Movetoward nearest plot, and ask for decontamination if arrived.
        if self.arrived then
            -- main effect is done: beeing decontaminated.
            if not meKnowledge:isContaminated() then
                meKnowledge:sendMessage( "The unit is decontaminated" )
                Feedback( self.feedbacks.isDecontaminated )
                return
            end
            Activate( skill.nodes.RequestDecontamination, 1, { entity = self.params.decontaminationPlot } )
        else
            Activate( skill.links.moveToward, 1, { entities = { self.params.decontaminationPlot } } )
        end
    end
}

-- **************************************************************************** 
-- Ask for decontamination
-- ****************************************************************************
node "RequestDecontamination"
{
    select = function( self )
        self.params.entity:requestDecontamination()
    end
}