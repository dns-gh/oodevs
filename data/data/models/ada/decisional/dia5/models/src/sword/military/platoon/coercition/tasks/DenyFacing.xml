<?xml version="1.0" encoding="UTF-8"?>
<task xmlns="http://www.masagroup.net/directia/schemas/bm" name="sword.military.platoon.coercition.tasks.DenyFacing" source-version="1.0.0" knowledge-class="sword.military.platoon.coercition.tasks.knowledges.Deny">
	<description>Interdire des objectifs à partir de positions fâce à d'autres positions représentant le danger</description>
	<parameters>
		<parameter name="objectives">
			<description>Les objectifs à interdire</description>
			<type>
				<list>
					<class name="sword.military.knowledge.decisional.Observable"/>
				</list>
			</type>
		</parameter>
		<parameter name="positions">
			<description>Positions à partir desquelles interdire les objectifs</description>
			<type>
				<list>
					<class name="sword.military.knowledge.decisional.Destroying"/>
					<class name="sword.military.knowledge.decisional.Observing"/>
				</list>
			</type>
		</parameter>
		<parameter name="obstacles" nullable="true">
			<type>
				<list>
					<class name="sword.military.world.Object"/>
				</list>
			</type>
			<default>
				<nil/>
			</default>
		</parameter>
		<parameter name="dangerPoints">
			<description>Points fâce auxquelles interdire</description>
			<type>
				<list>
					<class name="sword.military.knowledge.decisional.Observable"/>
				</list>
			</type>
		</parameter>
		<parameter name="withImprovement">
			<description>Si la valeur est vraie, on continue la construction en valorisant l'objectif.</description>
			<type>
				<simple name="boolean"/>
			</type>
		</parameter>
	</parameters>
	<goal>
		<description>Atteindre les positions d'interdictions et engagement d'un ennemi approchant.</description>
	</goal>
	<let name="enemiesAround">
		<value>
			<call method="sword.military.queries.enemies.getEnemiesInRange">
				<parameter name="probabilityToHit">
					<value>
						<number>0.5</number>
					</value>
				</parameter>
			</call>
		</value>
	</let>
	<stages>
		<stage label="Preparation du terrain" permanent="false" disable-when-done="false">
			<description>Building obstacles.</description>
			<goal>
				<description></description>
			</goal>
			<skills>
				<skill name="sword.military.platoon.skills.BuildWithoutReinforcement" main="true">
					<parameter name="entities">
						<value>
							<parameter>obstacles</parameter>
						</value>
					</parameter>
					<parameter name="withImprovement">
						<value>
							<parameter>withImprovement</parameter>
						</value>
					</parameter>
				</skill>
			</skills>
		</stage>
		<stage label="Interdiction des objetifs" permanent="true" disable-when-done="false">
			<description>Interdiction des objetifs</description>
			<goal>
				<description>Engaging enemies approaching the objectives.</description>
			</goal>
			<skills>
				<skill name="sword.military.platoon.skills.primitives.ObserveToward" priority="0.9">
					<parameter name="entities">
						<value>
							<parameter>dangerPoints</parameter>
						</value>
					</parameter>
					<parameter name="positions">
						<value>
							<parameter>positions</parameter>
						</value>
					</parameter>
				</skill>
				<skill name="sword.military.platoon.coercition.skills.Engage" priority="0.1">
					<parameter name="entities">
						<value>
							<parameter>enemiesAround</parameter>
						</value>
					</parameter>
					<parameter name="positions">
						<value>
							<parameter>positions</parameter>
						</value>
					</parameter>
				</skill>
			</skills>
		</stage>
	</stages>
</task>