-- ****************************************************************************
-- Observe toward observable entities
-- self.params.entity: the observable elements
-- self.params.area: the observing elements
-- ****************************************************************************
rootnode
{
    connections = { skill.nodes.ObserveTowardElement },

    done = function( self ) end,
    
    create = function( self )
        self.idAction = integration.startRecoLIA()
    end,

    -- --------------------------------------------------------------------------------
    -- For each objective of the skill, try to observe it.
    -- --------------------------------------------------------------------------------
    activate = function( self )
        local Activate = Activate
        for _, entity in pairs( self.params.entities ) do
            Activate( skill.nodes.ObserveTowardElement, entity:observationPriority(),
                { entity = entity, positions = self.params.positions } )
        end
    end,
    
    destroy = function( self )
        integration.stopRecoLIA( self.idAction )
    end,
}
-- ****************************************************************************
-- Straight movement toward the observing element
-- ****************************************************************************
node "ObserveTowardElement"
{
    connections = { skill.links.moveAndTakePosition, skill.links.observe },

    -- --------------------------------------------------------------------------------
    -- Move toward the observing elements using the skill MoveAndTakePosition
    -- --------------------------------------------------------------------------------
    activate = function( self )
        local Activate = Activate
        -- Main observation effort on current neutralizable element
        Activate( skill.links.observe, 1, { entity = self.params.entity } )

        -- Moving toward mounting positions
        for _, position in pairs ( self.params.positions ) do
            Activate( skill.links.moveAndTakePosition,
                position:observationEfficiency( self.params.entity ), { entity = position } )
        end
    end
}
