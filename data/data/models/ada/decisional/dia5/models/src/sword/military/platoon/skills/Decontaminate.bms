-- **************************************************************************** 
-- Decontaminate
-- Usue motoward and GetDecon
-- ****************************************************************************
rootnode
{
    connections = { skill.links.moveToward, skill.links.getDecon },

    -- -------------------------------------------------------------------------------- 
    -- feedback from moveToward
    -- --------------------------------------------------------------------------------
    done = function( self, params, additionnalParams )
        self.arrived = true
    end,
    
    -- -------------------------------------------------------------------------------- 
    -- feedback from GetDecon
    -- --------------------------------------------------------------------------------
    isDecontaminated = function( self, params, additionalParams )
        self.decontaminated = true
    end,

    -- -------------------------------------------------------------------------------- 
    -- Init 
    -- --------------------------------------------------------------------------------
    create = function( self )
        self.arrived = false
        self.decontaminated = false
        meKnowledge:forcerImmunisationNbc( true ) -- On immunise l'agent pour toute la durée de la mission
    end,
    -- -------------------------------------------------------------------------------- 
    -- Select nearest plot and move toward it, asking for decontamination
    -- --------------------------------------------------------------------------------
    activate = function( self )
        local Activate = Activate
        
        if self.decontaminated == false then
            Activate( skill.links.getDecon, 0.9, { objectives = self.params.objectives } )
        else
            Activate( skill.links.moveToward, 0.1, { entities = self.params.meetingPoint } )
        end
        
        self.arrived = false
    end,
    
    destroy = function( self )
         meKnowledge:forcerImmunisationNbc( false ) -- on arrête l'immunisation à la contamination NRBC à la fin de la mission
    end
}