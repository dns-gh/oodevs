<?xml version="1.0" encoding="UTF-8"?>
<task xmlns="http://www.masagroup.net/directia/schemas/bm" name="sword.military.platoon.tasks.Control" source-version="1.0.0" knowledge-class="sword.military.platoon.tasks.knowledges.Control">
	<description>
        Control and engage ennemies
    </description>
	<parameters>
		<parameter name="objective">
			<description>The objective to control.</description>
			<type>
				<class name="sword.military.knowledge.Controlable"/>
			</type>
		</parameter>
		<parameter name="obstacles" nullable="true">
			<type>
				<list>
					<class name="sword.military.world.Object"/>
				</list>
			</type>
			<default>
				<nil/>
			</default>
		</parameter>
		<parameter name="withImprovement">
			<description>Si la valeur est vraie, on continue la construction en valorisant l'objectif.</description>
			<type>
				<simple name="boolean"/>
			</type>
		</parameter>
	</parameters>
	<let name="destroyableEntities">
		<value>
			<call method="sword.military.queries.enemies.getEnemiesInRange">
				<parameter name="probabilityToHit">
					<value>
						<number>0.7</number>
					</value>
				</parameter>
			</call>
		</value>
	</let>
	<stages>
		<stage label="Preparation de terrain">
			<description>Building obstacles.</description>
			<goal>
				<description>Move toward the objective and control it.</description>
			</goal>
			<skills>
				<skill name="sword.military.platoon.skills.BuildWithReinforcement" main="true">
					<parameter name="entities">
						<value>
							<parameter>obstacles</parameter>
						</value>
					</parameter>
					<parameter name="withImprovement">
						<value>
							<parameter>withImprovement</parameter>
						</value>
					</parameter>
				</skill>
			</skills>
		</stage>
		<stage label="Deplacement vers l'objectif et contrÃ´le" permanent="true">
			<description>Deplacement vers position</description>
			<goal>
				<description>Controler 
</description>
			</goal>
			<skills>
				<skill name="sword.military.platoon.coercition.skills.Engage" priority="0.1">
					<parameter name="entities">
						<value>
							<parameter>destroyableEntities</parameter>
						</value>
					</parameter>
					<parameter name="positions">
						<value>
							<call method="sword.military.queries.tactical.getPositionsToDestroy">
								<parameter name="elementsToDestroy">
									<value>
										<parameter>destroyableEntities</parameter>
									</value>
								</parameter>
							</call>
						</value>
					</parameter>
				</skill>
				<skill name="sword.military.platoon.skills.Control" priority="0.9">
					<parameter name="objective">
						<value>
							<parameter>objective</parameter>
						</value>
					</parameter>
				</skill>
			</skills>
		</stage>
	</stages>
</task>