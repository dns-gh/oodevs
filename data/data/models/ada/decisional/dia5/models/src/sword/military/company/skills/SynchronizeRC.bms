-------------------------------------------------------------------------------
-- SynchornizeRC
-- Wait RC from entities to send a company level RC
-- @author MGD
-- @created 2011-03-04
--
-- This file is part of a MASA library or program.
-- Refer to the included end-user license agreement for restrictions.
--
-- Copyright (c) 2010 Mathématiques Appliquées SA (MASA)
-------------------------------------------------------------------------------

local limaReportAssociation =
{
    [ eTypeLima_LD ] = eRC_AttenteOrdreDeboucher,
    [ eTypeLima_LC ] = eRC_AttenteOrdrePoursuivre,
}

rootnode {

    connections = { skill.nodes.CR },

    done = function( self ) end,

    activate = function( self )
        local Activate = Activate
        if next( self.params.entities ) == nil then return end
        for lima, _ in pairs ( myself.reportMessages ) do
          if myself.reportMessages[lima] >= #self.params.entities then
            Activate( skill.nodes.CR, 1, { report = limaReportAssociation[ lima ] } )
          end
        end
    end,
}

node "CR"
{
    create = function( self )
        meKnowledge:RC( self.params.report )
    end
}
