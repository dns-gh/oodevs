-------------------------------------------------------------------------------
-- GiveOrderIlluminate
-- @author GGE
-- @created 2010-06-09
-- @modified
--
-- This file is part of a MASA library or program.
-- Refer to the included end-user license agreement for restrictions.
--
-- Copyright (c) 2010 MASA Group
-------------------------------------------------------------------------------

rootnode
{
    connections = { skill.nodes.IssueTask },

    done = function( self ) end,

    feedbacks = { "done" },

    create = function( self )
        local Activate = Activate
        self.isilluminated = false

        if next(self.params.illuminateally) == nil then --case when no illuminating unit exist in automat
           Feedback( self.feedbacks.done, { state = "illuminating impossible" } ) 
           return
        end
        local task = "platoon.tasks.Illuminer" -- $$$ MIA ne pas mettre la mission Francaise!
        for _, entity in pairs( self.params.illuminateally ) do
            if integration.isMissionAgentAvailable( entity.source, task ) then
                Activate( skill.nodes.IssueTask, 1, { entity = entity, task = task, objective = self.params.entity, ally = meKnowledge } )
            end
        end
    end,

}

node "IssueTask"
{
    select = function( self )
        local mission_objectives = { entity = self.params.objective, ally = self.params.ally }
        meKnowledge:sendTaskToPion( self.params.entity, self.params.task, mission_objectives, eEtatEchelon_First )
    end
}
