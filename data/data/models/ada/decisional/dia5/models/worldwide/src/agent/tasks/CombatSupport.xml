<?xml version="1.0" encoding="UTF-8"?>
<task xmlns="http://www.masagroup.net/directia/schemas/bm" name="agent.tasks.CombatSupport" source-version="1.0.0" knowledge-class="agent.tasks.knowledges.CombatSupport">
    <description>For the agent, to know how to support a set of friend units. The agent decides to follow the given units from one supporting position to another. The agent provide fires if encountered enemies are firing at one of the supported units.</description>
    <parameters>
        <parameter name="objectives">
            <description>The units to be supported.</description>
            <type>
                <list>
                    <class name="properties.Supportable"/>
                </list>
            </type>
        </parameter>
        <parameter name="retrogradeContext" nullable="true">
            <description>Define if the mission is performed in offensive context of defensive context.</description>
            <type>
                <simple name="boolean"/>
            </type>
            <default>
                <boolean>false</boolean>
            </default>
        </parameter>
    </parameters>
    <goal>
        <description>Rester en mesure d'appuyer (tir/observation) les objectifs.</description>
    </goal>
    <stages>
        <stage label="support" permanent="true">
            <let name="enemiesInRange">
                <value>
                    <call method="queries.getEnemiesEngagingFriends">
                        <parameter name="dynamic">
                            <value>
                                <boolean>true</boolean>
                            </value>
                        </parameter>
                        <parameter name="friends">
                            <value>
                                <parameter>objectives</parameter>
                            </value>
                        </parameter>
                    </call>
                </value>
            </let>
            <skills>
                <skill name="agent.skills.Support" priority="0.1">
                    <parameter name="entities">
                        <value>
                            <parameter>objectives</parameter>
                        </value>
                    </parameter>
                    <parameter name="retrogradeContext">
                        <value>
                            <parameter>retrogradeContext</parameter>
                        </value>
                    </parameter>
                </skill>
                <skill name="agent.skills.Engage" priority="0.8">
                    <parameter name="entities">
                        <value>
                            <parameter>enemiesInRange</parameter>
                        </value>
                    </parameter>
                    <parameter name="positions">
                        <value>
                            <call method="queries.getPositionsToNeutralize">
                                <parameter name="elementsToNeutralize">
                                    <value>
                                        <parameter>enemiesInRange</parameter>
                                    </value>
                                </parameter>
                            </call>
                        </value>
                    </parameter>
                </skill>
                <skill name="agent.skills.actions.ApplyMortarFires" priority="0.1"/>
            </skills>
        </stage>
    </stages>
</task>