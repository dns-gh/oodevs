<?xml version="1.0"?>
<project name="host_agent" default="all">

    <property environment="env"/>
    <property name="env.PONEY_HOME" value="//install/masa/common/dev/common/poney"/>
    <import file="${env.PONEY_HOME}/poney.xml"/>

    <property name="samples.dir" value="../src/samples"/>

    <condition property="os.platform" value="windows" else="linux">
        <os family="windows"/>
    </condition>

    <!-- Libraries -->
    <target name="libraries" depends="runtime,host,web" description="build all libraries"/>

    <target name="runtime" description="build runtime library">
        <build-lib name="runtime">
            <defineset define="_CRT_SECURE_NO_WARNINGS"/>
        </build-lib>
    </target>

    <target name="host" description="build host library">
        <build-lib name="host">
            <defineset define="_CRT_SECURE_NO_WARNINGS"/>
            <defineset define="_SCL_SECURE_NO_WARNINGS"/>
        </build-lib>
    </target>

    <target name="web" description="build web library">
        <build-lib name="web">
            <defineset define="_CRT_SECURE_NO_WARNINGS"/>
            <defineset define="_SCL_SECURE_NO_WARNINGS"/>
        </build-lib>
    </target>

    <!-- Samples -->
    <target name="samples" depends="sample_agent" description="build all samples"/>

    <target name="sample_agent" depends="runtime,host,web" description="build sample host agent">
        <build-app name="sample_agent" subsystem="console" depends="boost,cpp-netlib" root="${samples.dir}" libs="runtime@{suffix},host@{suffix},web@{suffix}">
            <syslibset libs="ws2_32"/>
            <defineset define="_CRT_SECURE_NO_WARNINGS"/>
        </build-app>
    </target>

    <!-- Tests -->
    <target name="tests" depends="host_test,runtime_test,web_test" description="build tests"/>

    <target name="runtime_test" depends="runtime" description="build runtime tests">
        <build-test name="runtime" depends="boost" libs="runtime@{suffix}">
            <defineset define="_CRT_SECURE_NO_WARNINGS"/>
        </build-test>
    </target>

    <target name="host_test" depends="host,runtime" description="build host tests">
        <build-test name="host" depends="boost" libs="host@{suffix},runtime@{suffix}">
            <defineset define="_CRT_SECURE_NO_WARNINGS"/>
        </build-test>
    </target>

    <target name="web_test" depends="web" description="build web tests">
        <build-test name="web" depends="boost" libs="web@{suffix}">
            <defineset define="_CRT_SECURE_NO_WARNINGS"/>
        </build-test>
    </target>

    <!-- Reports -->
    <target name="reports" description="generate reports">
        <cppcheck-report>
            <arg line="--suppress=useAutoPointerCopy"/>
            <arg line="--suppress=unusedFunction"/>
        </cppcheck-report>
        <headers name="host"/>
        <headers name="runtime"/>
        <headers name="web"/>
    </target>

    <!-- Configure -->
    <target name="configure" description="retrieve dependencies">
        <update name="boost" version="1.48"/>
        <update name="cpp-netlib"/>
        <update name="turtle"/>
    </target>

    <!-- Clean -->
    <target name="clean" description="clean intermediate build artifacts">
        <delete dir="${reports.dir}"/>
        <delete dir="${out.dir}"/>
    </target>

    <!-- All -->
    <target name="all" depends="clean,configure,libraries,samples,tests,reports"/>
</project>
