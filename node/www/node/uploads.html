[#ftl]
<div class="row">
    <div class="span9">
        <div class="hide">
            <iframe id="upload_target" name="upload_target"></iframe>
        </div>
        <form id="upload_form" class="form-horizontal" enctype="multipart/form-data" method="post" target="upload_target">
            <div class="control-group">
                <label class="control-label"><strong>Package</strong></label>
                <div class="controls">
                    <input type="file" name="cache"/>
                    <a class="btn upload disabled"><i class="icon-upload"></i> Upload</a>
                </div>
            </div>
        </form>
        <div id="upload_error"></div>
        <div class="hide alert alert-info upload_alert">
            <a class="spin_btn"></a>
            <span>
                <strong>Uploading, </strong>
                please wait...
            </span>
        </div>
        <div id="packages">
            [#-- auto-generated templates --]
            <script type="text/template" id="upload_error_template">
                <div class="alert alert-error"><b>Error</b> {{content}}</div>
            </script>
            <script type="text/template" id="package_template">
                <form class="package accordion-group">
                    <div class="package_name">
                        {{name}}
                        <br/>
                        <span class="label label-info">{{version}}</span>
                    </div>
                    <div class="package_description"> {{description}} </div>
                    {{#if items.length}}
                    <table class="table table-striped">

                        [#assign num_cols = 4 ]
                        [#macro header more type item]
                        <tr class="package_row${more}">
                            <${item} class="type">${type}s</${item}>
                            <${item}>Date</${item}>
                            <${item}>Checksum</${item}>
                            <${item}></${item}>
                        </tr>
                        [/#macro]

                        [#macro row type]
                        {{#is_header items "${type}"}}
                        <thead>
                            [@header '' type 'th' /]
                        </thead>
                        <tbody>
                            {{else}}
                            {{#has_item_type items "${type}"}}
                            {{#is_odd_row items "${type}"}}
                            <tr class="hide"><td colspan="${num_cols}"></td></tr>
                            {{/is_odd_row}}
                            [@header ' sub_header' type 'td' /]
                            {{/has_item_type}}
                            {{/is_header}}

                            {{#forall items "${type}"}}
                            <tr data-rel="briefing_{{id}}" class="package_row">
                                <td class="name">
                                    {{name}}
                                    {{#equal action "error"}}
                                    <span>
                                        <a class="label label-important error" rel="tooltip" title="{{error}}">Error</a>
                                    </span>
                                    {{/equal}}
                                </td>
                                <td class="date">{{date}}</td>
                                <td class="checksum">{{#if checksum.length}}0x{{checksum}}{{/if}}</td>
                                <td class="action">
                                    {{#equal action "add"}}
                                    <a class="btn add" data-toggle="button"><i class="icon-plus"></i> Add </a>
                                    {{/equal}}
                                    {{#equal action "update"}}
                                    <a class="btn update" data-toggle="button"><i class="icon-chevron-up"></i> Update </a>
                                    {{/equal}}
                                    [#if type == "exercise"]
                                    <a class="btn more" data-toggle="button"><i class="icon-th-list"></i> More <span class="caret"></span></a>
                                    [/#if]
                                </td>
                            </tr>
                            [#if type == "exercise"]
                            <tr id="briefing_{{id}}" class="hide">
                                <td colspan="${num_cols}" class="item_briefing">
                                    {{#if model.length}}<div><span class="item_label">Model</span> {{model}}</div>{{/if}}
                                    {{#if terrain.length}}<div><span class="item_label">Terrain</span> {{terrain}}</div>{{/if}}
                                    <div class="briefing_content">{{{briefing}}}</div>
                                </td>
                            </tr>
                            <tr class="hide"><td colspan="${num_cols}"></td></tr>
                            [/#if]
                            {{/forall}}
                            [/#macro]
                            [@row type="model" /]
                            [@row type="terrain" /]
                            [@row type="exercise" /]
                        </tbody>
                    </table>
                    <div class="form-actions">
                        <a class="btn save"><i class="icon-ok"></i> Install</a>
                        <a class="btn btn-primary discard"><i class="icon-remove"></i> Discard</a>
                    </div>
                    {{/if}}
                </form>
            </script>
        </div>
    </div>
</div>
