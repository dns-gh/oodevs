<project name="gosword" default="all">

    <property environment="env"/>
    <property name="env.PONEY_HOME" value="//file1/masa/common/dev/common/poney"/>
    <import file="${env.PONEY_HOME}/poney.xml"/>

    <var name="repositories" value="${repositories},${sword.repository}"/>
    <property name="sword_branch" value="trunk"/>

    <target name="update">
        <update name="golang"/>
        <update name="goprotobuf"/>
        <update name="models" package="decisional-dev" todir="${data.dir}/data/models"/>
        <update name="models" package="exercises-dev" todir="${data.dir}/exercises"/>
        <update name="models" package="propagations-dev" todir="${data.dir}/data/propagations"/>
        <update name="models" package="terrains-dev" todir="${data.dir}/data/terrains"/>
        <update name="protobuf"/>
        <update name="sword" 
                version="Defense/releases/internal/${sword_branch}"
                package="protobuf-dev"
                todir="${src.dir}/sword"/>
        <update name="sword"
                version="Defense/releases/internal/${sword_branch}"
                package="SWORD_binaries_${platform}_${sword_branch}"
                todir="${run.dir}"/>
    </target>

    <target name="proto">
        <go_proto input="${src.dir}/sword"/>
    </target>

    <target name="build">
        <go cmd="install"/>
    </target>

    <target name="test">
        <go cmd="test">
            <arg value="--application=${run.dir}/simulation_app.exe"/>
            <arg value="--root-dir=${data.dir}"/>
        </go>
    </target>

    <target name="package">
        <go_package/>
    </target>

    <target name="all" depends="update,proto,build,test,package"/>

    <!-- helper targets -->
    <target name="fmt">
        <go cmd="fmt"/>
    </target>    

</project>
