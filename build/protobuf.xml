<?xml version="1.0"?>
<project>
    <description>
        build task for Protocol Buffers (http://code.google.com/p/protobuf)
    </description>

    <import file="${extensions.dir}/generate.xml"/>

    <condition property="python" value="python.exe" else="python">
        <os family="windows"/>
    </condition>

    <macrodef name="protoc">
        <attribute name="file"/>
        <attribute name="builddir"/>
        <attribute name="outdir"/>
        <sequential>
            <exec
                taskname="protoc"
                executable="${python}"
                failonerror="true"
                timeout="60000">
                <arg value="${root.dir}/build/cppproto.py" />
                <arg value="@{file}"/>
                <arg value="@{builddir}"/>
                <arg value="@{outdir}"/>
            </exec>
        </sequential>
    </macrodef>

    <macrodef name="protobuf-pre-build">
        <attribute name="name"/>
        <attribute name="input"/>
        <attribute name="outdir"/>
        <attribute name="excludes"/>
        <attribute name="mode"/>
        <sequential>
            <generate
                input="@{input}"
                excludes="@{excludes}"
                extension="proto"
                target="@{outdir}/@{basedir}@{basename}.pb.cc">
                <protoc
                    file="@{file}"
                    builddir="@{outdir}/@{basedir}"
                    outdir="@{outdir}/@{basedir}" />
            </generate>
        </sequential>
    </macrodef>

</project>
